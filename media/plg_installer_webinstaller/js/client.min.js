var _createClass=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}();function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}if(!window.jQuery)throw new Error("WebInstaller plugin requires jQuery");if(!Joomla)throw new Error("Joomla API is not properly initialised");!function(e,t,i,n){"use strict";var l={view:"dashboard",id:0,ordering:"",list:0,options:i.getOptions("plg_installer_webinstaller",{})},a=void 0,r=function(){function a(){_classCallCheck(this,a)}return _createClass(a,[{key:"initialise",value:function(){if(l.loaded=1,t.getElementById("myTabContent")){var e=t.getElementById("web");t.getElementById("uploadform-web-cancel").addEventListener("click",function(){t.getElementById("uploadform-web").classList.add("hidden"),l.list&&t.querySelector(".list-view")&&t.querySelector(".list-view").click()}),e.insertAdjacentHTML("afterbegin",'<div id="appsloading" class="ifw-loading-container"></div>'),e.style.position="absolute",n("#appsloading").on("ajaxStart",function(){t.body.classList.add("ifw-busy"),t.getElementById("appsloading").classList.remove("hidden")}).on("ajaxStop",function(){t.getElementById("appsloading").classList.add("hidden"),t.body.classList.remove("ifw-busy")})}this.loadweb(l.options.base_url+"index.php?format=json&option=com_apps&view=dashboard"),this.clickforlinks()}},{key:"loadweb",value:function(i){if(!i)return!1;var r=this,o=new RegExp(l.options.base_url),s=new RegExp("^index.php");if(!o.test(i)&&!s.test(i))return e.open(i,"_blank"),!1;var d=i+"&product="+l.options.product+"&release="+l.options.release+"&dev_level="+l.options.dev_level+"&list="+(l.list?"list":"grid")+"&lang="+l.options.language;if(""!==l.ordering&&t.getElementById("com-apps-ordering").value&&(l.ordering=t.getElementById("com-apps-ordering").value,d+="&ordering="+l.ordering),t.getElementById("myTabContent")){var c=t.getElementById("appsloading");c.style.position="absolute",c.style.left="0",c.style.top="0",c.style.width="100%",c.style.height="100%";var u=t.getElementById("web");u.style.position="relative",u.appendChild(c),n("#appsloading").trigger("ajaxStart")}return n.ajax({url:d,dataType:"jsonp",cache:!0,jsonpCallback:"jedapps_jsonpcallback",timeout:2e4,success:function(e){t.getElementById("web-loader")&&t.getElementById("web-loader").classList.add("hidden"),t.getElementById("jed-container").innerHTML=e.data.html,t.getElementById("com-apps-searchbox").addEventListener("keypress",function(e){13===e.which&&r.initiateSearch()}),t.getElementById("search-reset").addEventListener("click",function(){t.getElementById("com-apps-searchbox").value="",r.initiateSearch()});var i=t.getElementById("com-apps-ordering");i&&i.addEventListener("change",function(){var e=i.selectedIndex;l.ordering=i.options[e].value,r.installfromwebajaxsubmit()}),""!==l.options.installfrom_url&&a.installfromweb(l.options.installfrom_url)},fail:function(){t.getElementById("web-loader")&&(t.getElementById("web-loader").classList.add("hidden"),t.getElementById("web-loader-error").classList.remove("hidden"))},complete:function(){var e=t.getElementById("joomlaapsinstallatinput");e&&(e.value=l.options.installat_url),r.clickforlinks(),a.clicker(),"extension"!==l.view&&[].slice.call(t.querySelectorAll("div.load-extension")).forEach(function(e){e.addEventListener("click",function(t){t.preventDefault(),r.loadweb(l.options.base_url+e.getAttribute("data-url"))}),e.setAttribute("href","#")}),l.list&&t.querySelector(".list-view")&&t.querySelector(".list-view").click(),t.getElementById("myTabContent")&&n("#appsloading").trigger("ajaxStop")},error:function(e){var i=t.getElementById("web-loader-error"),n=t.getElementById("web-loader");e.responseText&&i&&(i.innerHTML=e.responseText),n&&(n.classList.add("hidden"),i.classList.remove("hidden"))}}),!0}},{key:"clickforlinks",value:function(){var e=this;[].slice.call(t.querySelectorAll("a.transcode")).forEach(function(t){var i=t.getAttribute("href");t.addEventListener("click",function(t){var n=new RegExp(l.options.base_url),a=new RegExp("^index.php");n.test(i)||a.test(i)?(l.view=i.replace(/^.+[&?]view=(\w+).*$/,"$1"),"dashboard"===l.view?l.id=0:"category"===l.view&&(l.id=i.replace(/^.+[&?]id=(\d+).*$/,"$1")),t.preventDefault(),e.loadweb(l.options.base_url+i)):(t.preventDefault(),e.loadweb(i))}),t.setAttribute("href","#")})}},{key:"initiateSearch",value:function(){l.view="dashboard",this.installfromwebajaxsubmit()}},{key:"installfromwebajaxsubmit",value:function(){var e="&view="+l.view;(l.id&&(e+="&id="+l.id),t.getElementById("com-apps-searchbox").value)&&(e+="&filter_search="+encodeURI(t.getElementById("com-apps-searchbox").value.toLowerCase().replace(/ +/g,"_").replace(/[^a-z0-9-_]/g,"").trim()));""!==l.ordering&&t.getElementById("com-apps-ordering").value&&(l.ordering=t.getElementById("com-apps-ordering").value),l.ordering&&(e+="&ordering="+l.ordering),this.loadweb(l.options.base_url+"index.php?format=json&option=com_apps"+e)}}],[{key:"clicker",value:function(){t.querySelector(".grid-view")&&t.querySelector(".grid-view").addEventListener("click",function(){l.list=0,t.querySelector(".list-container").classList.add("hidden"),t.querySelector(".grid-container").classList.remove("hidden"),t.getElementById("btn-list-view").classList.remove("active"),t.getElementById("btn-grid-view").classList.remove("active")}),t.querySelector(".list-view")&&t.querySelector(".list-view").addEventListener("click",function(){l.list=1,t.querySelector(".grid-container").classList.add("hidden"),t.querySelector(".list-container").classList.remove("hidden"),t.getElementById("btn-grid-view").classList.remove("active"),t.getElementById("btn-list-view").classList.add("active")})}},{key:"installfromweb",value:function(e,n){if(!e)return alert(i.JText._("PLG_INSTALLER_WEBINSTALLER_CANNOT_INSTALL_EXTENSION_IN_PLUGIN")),!1;var l=t.getElementById("install_url"),a=t.getElementById("uploadform-web-url");(l.value=e,a.innerHTML=e,n)?(t.getElementById("uploadform-web-name").innerHTML=n,t.getElementById("uploadform-web-name-label").classList.remove("hidden")):t.getElementById("uploadform-web-name-label").classList.add("hidden");return t.getElementById("uploadform-web").classList.remove("hidden"),!0}},{key:"installfromwebexternal",value:function(i){return!0===e.confirm("You will be redirected to the following link to complete the registration/purchase - \n"+i)&&(t.getElementById("adminForm").setAttribute("action",i),t.querySelector("input[name=task]").setAttribute("disabled",!0),t.querySelector("input[name=install_directory]").setAttribute("disabled",!0),t.querySelector("input[name=install_url]").setAttribute("disabled",!0),t.querySelector("input[name=installtype]").setAttribute("disabled",!0),t.querySelector("input[name=filter_search]").setAttribute("disabled",!0),!0)}}]),a}();n(function(e){var t=e("#myTabTabs").find('a[href="#web"]');l.options.installfromon&&t.click(),t.hasClass("active")&&(a||(a=new r).initialise()),t.closest("li").click(function(){a||(a=new r).initialise()}),""!==l.options.installfrom_url&&t.closest("li").click(),t.on("shown.bs.tab",function(){a||(a=new r).initialise()})})}(window,document,Joomla,window.jQuery);