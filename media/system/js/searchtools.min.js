!function(){"use strict";var t=function(t,e){this.element=t,this.options=Joomla.extend({formSelector:".js-stools-form",searchFieldSelector:".js-stools-field-search",clearBtnSelector:".js-stools-btn-clear",mainContainerSelector:".js-stools",searchBtnSelector:".js-stools-btn-search",filterBtnSelector:".js-stools-btn-filter",filterContainerSelector:".js-stools-container-filters",filtersHidden:!0,listBtnSelector:".js-stools-btn-list",listContainerSelector:".js-stools-container-list",listHidden:!0,orderColumnSelector:".js-stools-column-order",orderBtnSelector:".js-stools-btn-order",orderFieldSelector:".js-stools-field-order",orderFieldName:"list[fullordering]",limitFieldSelector:".js-stools-field-limit",defaultLimit:20,activeOrder:null,activeDirection:"ASC",clearListOptions:!1},e),this.theForm=document.querySelector(this.options.formSelector),this.filterButton=document.querySelector(this.options.formSelector+" "+this.options.filterBtnSelector),this.filterContainer=document.querySelector(this.options.formSelector+" "+this.options.filterContainerSelector)?document.querySelector(this.options.formSelector+" "+this.options.filterContainerSelector):"",this.filtersHidden=this.options.filtersHidden,this.listButton=document.querySelector(this.options.listBtnSelector),this.listContainer=document.querySelector(this.options.formSelector+" "+this.options.listContainerSelector),this.listHidden=this.options.listHidden,this.mainContainer=document.querySelector(this.options.mainContainerSelector),this.searchButton=document.querySelector(this.options.formSelector+" "+this.options.searchBtnSelector),this.searchField=document.querySelector(this.options.formSelector+" "+this.options.searchFieldSelector),this.searchString=null,this.clearButton=document.querySelector(this.options.clearBtnSelector),this.orderCols=Array.prototype.slice.call(document.querySelectorAll(this.options.formSelector+" "+this.options.orderColumnSelector)),this.orderField=document.querySelector(this.options.formSelector+" "+this.options.orderFieldSelector),this.limitField=document.querySelector(this.options.formSelector+" "+this.options.limitFieldSelector),this.activeColumn=null,this.activeDirection=this.options.activeDirection,this.activeOrder=this.options.activeOrder,this.activeLimit=null,this.clearListOptions=this.options.clearListOptions,this.init()};t.prototype={init:function(){var t=this;document.addEventListener||this.searchField.value===this.searchField.getAttribute("placeholder")&&(this.searchField.value=""),this.searchString=this.searchField.value,this.filterContainer&&this.filterContainer.classList.contains("js-stools-container-filters-visible")?(this.showFilters(),this.showList()):(this.hideFilters(),this.hideList()),t.filterButton&&t.filterButton.addEventListener("click",function(e){t.toggleFilters(),e.stopPropagation(),e.preventDefault()}),t.listButton&&t.listButton.addEventListener("click",function(e){t.toggleList(),e.stopPropagation(),e.preventDefault()}),t.getFilterFields()&&t.getFilterFields().forEach(function(e){t.checkFilter(e),e.addEventListener("change",function(){t.checkFilter(e)})}),t.clearButton&&t.clearButton.addEventListener("click",function(){t.clear()}),this.createOrderField(),t.orderCols.forEach(function(e){e.addEventListener("click",function(){var e=this.getAttribute("data-order"),i=this.getAttribute("data-direction"),r=e+" "+i;e.length&&(t.activeColumn=e,r!==t.activeOrder?(t.activeDirection=i,t.activeOrder=r,t.updateFieldValue(t.orderField,r)):t.toggleDirection(),t.theForm.submit())})}),t.checkActiveStatus(t),document.body.addEventListener("click",function(e){document.body.classList.contains("filters-shown")&&t.hideFilters()}),t.filterContainer.addEventListener("click",function(t){t.stopPropagation()},!0)},checkFilter:function(t){var e=t.querySelector("option:checked");e&&(""!==e.value?this.activeFilter(t,this):this.deactiveFilter(t,this))},clear:function(){var t=this;t.searchField&&(t.searchField.value=""),t.getFilterFields()&&t.getFilterFields().forEach(function(e){e.value="",t.checkFilter(e),window.jQuery&&jQuery.chosen&&jQuery(e).trigger("liszt:updated")}),t.clearListOptions&&(t.getListFields().forEach(function(e){e.value="",t.checkFilter(e),window.jQuery&&jQuery.chosen&&jQuery(e).trigger("liszt:updated")}),document.querySelector("#list_limit").value=t.options.defaultLimit,window.jQuery&&jQuery.chosen&&jQuery("#list_limit").trigger("liszt:updated")),t.theForm.submit()},checkActiveStatus:function(t){var e=t.mainContainer;[].slice.call(e.querySelectorAll(".js-stools-field-filter select")).forEach(function(e){if(e.classList.contains("active"))return t.filterButton.classList.remove("btn-secondary"),t.filterButton.classList.add("btn-primary"),""})},activeFilter:function(t,e){t.classList.add("active");var i="#"+t.getAttribute("id"),r=t.querySelector(i);r&&r.classList.add("active")},deactiveFilter:function(t,e){t.classList.remove("active");var i="#"+t.getAttribute("id"),r=t.querySelector(i);r&&r.classList.remove("active")},getFilterFields:function(){if(this.filterContainer)return Array.prototype.slice.call(this.filterContainer.querySelectorAll("select,input"))},getListFields:function(){return Array.prototype.slice.call(this.listContainer.querySelectorAll("select"))},hideContainer:function(t){t&&(t.classList.remove("js-filters-show"),document.body.classList.remove("filters-shown"))},showContainer:function(t){t.classList.add("js-filters-show"),document.body.classList.add("filters-shown")},toggleContainer:function(t){t.classList.contains("js-filters-show")?this.hideContainer(t):this.showContainer(t)},hideList:function(){this.hideContainer(this.filterContainer)},showList:function(){this.showContainer(this.filterContainer)},toggleList:function(){this.toggleContainer(this.filterContainer)},hideFilters:function(){this.hideContainer(this.filterContainer)},showFilters:function(){this.showContainer(this.filterContainer)},toggleFilters:function(){this.toggleContainer(this.filterContainer)},toggleDirection:function(){var t="ASC";"ASC"==this.activeDirection.toUpperCase()&&(t="DESC"),this.activeDirection=t,this.activeOrder=this.activeColumn+" "+t,this.updateFieldValue(this.orderField,this.activeOrder)},createOrderField:function(){if(this.orderField||(this.orderField=document.createElement("input"),this.orderField.setAttribute("type","hidden"),this.orderField.setAttribute("id","js-stools-field-order"),this.orderField.setAttribute("class","js-stools-field-order"),this.orderField.setAttribute("name",this.options.orderFieldName),this.orderField.setAttribute("value",this.activeOrder+" "+this.activeDirection),this.theForm.innerHTML+=this.orderField.outerHTML),"select"==this.orderField.tagName.toLowerCase()){for(var t=this.orderField.options,e=0,i=t.length;i>e;e++){var r,o=t[e].getAttribute("data-order"),s=t[e].getAttribute("data-name"),n=t[e].getAttribute("data-direction");if(o&&o.length)if(o=o+" "+n,!(r=this.findOption(this.orderField,o)).length)(r=document.createElement("option")).text=s,r.value=o,t[e].classList.contains("active")&&r.setAttribute("selected","selected"),this.orderFieldName.innerHTML+=r}window.jQuery&&jQuery.chosen&&jQuery(this.orderField).trigger("liszt:updated")}this.activeOrder=this.orderField.value},updateFieldValue:function(t,e){var i=t.getAttribute("type");if("hidden"===i||"text"===i)t.setAttribute("value",e);else if("select"===t.tagName.toLowerCase()){for(var r=t.options,o=0,s=r.length;s>o;o++)if(r[o].value==e)var n=r[o];if(n&&n.length)n.setAttribute("selected","selected");else{var l=document.createElement("option");l.text=name,l.value=e,l.setAttribute("selected","selected"),t.appendChild(l)}t.value=e,window.jQuery&&jQuery.chosen&&t.trigger("liszt:updated")}},findOption:function(t,e){for(var i=0,r=t.length;r>i;i++)if(t[i].value==e)return t[i]}},document.addEventListener("DOMContentLoaded",function(){if(Joomla.getOptions("searchtools")){var e=Joomla.getOptions("searchtools"),i=document.querySelector(e.selector);new t(i,e)}})}();