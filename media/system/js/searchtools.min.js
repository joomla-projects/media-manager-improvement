!function(){"use strict";var a=function(a,b){var c={formSelector:".js-stools-form",searchFieldSelector:".js-stools-field-search",clearBtnSelector:".js-stools-btn-clear",mainContainerSelector:".js-stools",searchBtnSelector:".js-stools-btn-search",filterBtnSelector:".js-stools-btn-filter",filterContainerSelector:".js-stools-container-filters",filtersHidden:!0,listBtnSelector:".js-stools-btn-list",listContainerSelector:".js-stools-container-list",listHidden:!0,orderColumnSelector:".js-stools-column-order",orderBtnSelector:".js-stools-btn-order",orderFieldSelector:".js-stools-field-order",orderFieldName:"list[fullordering]",limitFieldSelector:".js-stools-field-limit",defaultLimit:20,activeOrder:null,activeDirection:"ASC",clearListOptions:!1};this.element=a,this.options=Joomla.extend(c,b),this.theForm=document.querySelector(this.options.formSelector),this.filterButton=document.querySelector(this.options.formSelector+" "+this.options.filterBtnSelector),this.filterContainer=document.querySelector(this.options.formSelector+" "+this.options.filterContainerSelector)?document.querySelector(this.options.formSelector+" "+this.options.filterContainerSelector):"",this.filtersHidden=this.options.filtersHidden,this.listButton=document.querySelector(this.options.listBtnSelector),this.listContainer=document.querySelector(this.options.formSelector+" "+this.options.listContainerSelector),this.listHidden=this.options.listHidden,this.mainContainer=document.querySelector(this.options.mainContainerSelector),this.searchButton=document.querySelector(this.options.formSelector+" "+this.options.searchBtnSelector),this.searchField=document.querySelector(this.options.formSelector+" "+this.options.searchFieldSelector),this.searchString=null,this.clearButton=document.querySelector(this.options.clearBtnSelector),this.orderCols=Array.prototype.slice.call(document.querySelectorAll(this.options.formSelector+" "+this.options.orderColumnSelector)),this.orderField=document.querySelector(this.options.formSelector+" "+this.options.orderFieldSelector),this.limitField=document.querySelector(this.options.formSelector+" "+this.options.limitFieldSelector),this.activeColumn=null,this.activeDirection=this.options.activeDirection,this.activeOrder=this.options.activeOrder,this.activeLimit=null,this.clearListOptions=this.options.clearListOptions,this.init()};a.prototype={init:function(){var a=this;document.addEventListener||this.searchField.value===this.searchField.getAttribute("placeholder")&&(this.searchField.value=""),this.searchString=this.searchField.value,this.filterContainer&&this.filterContainer.classList.contains("js-stools-container-filters-visible")?(this.showFilters(),this.showList()):(this.hideFilters(),this.hideList()),a.filterButton&&a.filterButton.addEventListener("click",function(b){a.toggleFilters(),b.stopPropagation(),b.preventDefault()}),a.listButton&&a.listButton.addEventListener("click",function(b){a.toggleList(),b.stopPropagation(),b.preventDefault()}),a.getFilterFields()&&a.getFilterFields().forEach(function(b){a.checkFilter(b),b.addEventListener("change",function(){a.checkFilter(b)})}),a.clearButton&&a.clearButton.addEventListener("click",function(){a.clear()}),this.createOrderField(),a.orderCols.forEach(function(b){b.addEventListener("click",function(){var b=this.getAttribute("data-order"),c=this.getAttribute("data-direction"),d=b+" "+c;b.length&&(a.activeColumn=b,d!==a.activeOrder?(a.activeDirection=c,a.activeOrder=d,a.updateFieldValue(a.orderField,d)):a.toggleDirection(),a.theForm.submit())})})},checkFilter:function(a){var b=this;""!==a.querySelector("option:checked").value?b.activeFilter(a):b.deactiveFilter(a)},clear:function(){var a=this;a.getFilterFields()&&a.getFilterFields().forEach(function(b){b.value="",a.checkFilter(b),window.jQuery&&jQuery.chosen&&jQuery(b).trigger("liszt:updated")}),a.clearListOptions&&(a.getListFields().forEach(function(b){b.value="",a.checkFilter(b),window.jQuery&&jQuery.chosen&&jQuery(b).trigger("liszt:updated")}),document.querySelector("#list_limit").value=a.options.defaultLimit,window.jQuery&&jQuery.chosen&&jQuery("#list_limit").trigger("liszt:updated")),a.theForm.submit()},activeFilter:function(a){a.classList.add("active");var b="#"+a.getAttribute("id"),c=a.querySelector(b);c&&c.classList.add("active")},deactiveFilter:function(a){a.classList.remove("active");var b="#"+a.getAttribute("id"),c=a.querySelector(b);c&&c.classList.remove("active")},getFilterFields:function(){if(this.filterContainer)return Array.prototype.slice.call(this.filterContainer.querySelectorAll("select,input"))},getListFields:function(){return Array.prototype.slice.call(this.listContainer.querySelectorAll("select"))},hideContainer:function(a){a&&(a.style.display="none",a.classList.remove("shown"))},showContainer:function(a){a.style.display="block",a.classList.add("shown")},toggleContainer:function(a){a.classList.contains("shown")?this.hideContainer(a):this.showContainer(a)},hideList:function(){this.hideContainer(this.filterContainer)},showList:function(){this.showContainer(this.filterContainer)},toggleList:function(){this.toggleContainer(this.filterContainer)},hideFilters:function(){this.hideContainer(this.filterContainer)},showFilters:function(){this.showContainer(this.filterContainer)},toggleFilters:function(){this.toggleContainer(this.filterContainer)},toggleDirection:function(){var a=this,b="ASC";"ASC"==a.activeDirection.toUpperCase()&&(b="DESC"),a.activeDirection=b,a.activeOrder=a.activeColumn+" "+b,a.updateFieldValue(a.orderField,a.activeOrder)},createOrderField:function(){var a=this;if(this.orderField.length||(this.orderField=createElement("<input>"),this.orderField.setAttribute("type","hidden"),this.orderField.setAttribute("id","js-stools-field-order"),this.orderField.setAttribute("class","js-stools-field-order"),this.orderField.setAttribute("name",a.options.orderFieldName),this.orderField.setAttribute("value",a.activeOrder+" "+this.activeDirection),this.theForm.innerHTML+=this.orderField),"select"==this.orderField.tagName.toLowerCase()){for(var b=this.orderField.options,c=0,d=b.length;d>c;c++){var e=b[c].getAttribute("data-order"),f=b[c].getAttribute("data-name"),g=b[c].getAttribute("data-direction");if(e&&e.length){e=e+" "+g;var h=a.findOption(a.orderField,e);if(!h.length){var h=document.createElement("option");h.text=f,h.value=e,b[c].classList.contains("active")&&h.setAttribute("selected","selected"),a.orderFieldName.innerHTML+=h}}}window.jQuery&&jQuery.chosen&&jQuery(this.orderField).trigger("liszt:updated")}this.activeOrder=this.orderField.value},updateFieldValue:function(a,b){var c=a.getAttribute("type");if("hidden"===c||"text"===c)a.setAttribute("value",b);else if("select"===a.tagName.toLowerCase()){for(var d=a.options,e=0,f=d.length;f>e;e++)if(d[e].value==b)var g=d[e];if(g.length)g.setAttribute("selected","selected");else{var h=document.createElement("option");h.text=name,h.value=b,h.setAttribute("selected","selected"),a.appendChild(h)}a.value=b,window.jQuery&&jQuery.chosen&&a.trigger("liszt:updated")}},findOption:function(a,b){for(var c=0,d=a.length;d>c;c++)if(a[c].value==b)return a[c]}},document.addEventListener("DOMContentLoaded",function(){if(Joomla.getOptions("searchtools")){var b=Joomla.getOptions("searchtools");new a(document.querySelector(b.selector),b)}})}();