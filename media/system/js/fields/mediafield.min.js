!function(e){"use strict";e.fieldMedia=function(t,i){this.options=e.extend({},e.fieldMedia.defaults,i),this.$container=e(t),this.$modal=this.$container.find(this.options.modal),this.$modalBody=this.$modal.find(".modal-body"),this.$input=this.$container.find(this.options.input),this.$containerPreview=this.$container.find(this.options.previewContainer),this.$buttonSelect=this.$container.find(this.options.buttonSelect),this.$buttonClear=this.$container.find(this.options.buttonClear),this.$buttonSelect.on("click",this.modalOpen.bind(this)),this.$buttonClear.on("click",this.clearValue.bind(this)),this.$modal.on("hide",this.removeIframe.bind(this)),this.updatePreview()},e.fieldMedia.prototype.modalOpen=function(){this.$modal.modal("show"),e("body").addClass("modal-open");var t=this;this.$container.find(this.options.buttonSaveSelected).on("click",function(e){return e.stopPropagation(),t.selectedPath?t.setValue(t.options.rootFolder+t.selectedPath):t.setValue(""),t.modalClose(),!1}),window.document.addEventListener("onMediaFileSelected",function(e){e.item.path.match(/.jpg|.jpeg|.gif|.png/)?t.selectedPath=e.item.path:t.selectedPath=""})},e.fieldMedia.prototype.modalClose=function(){this.$modal.modal("hide"),e("body").removeClass("modal-open"),this.$modalBody.empty()},e.fieldMedia.prototype.removeIframe=function(){this.$modalBody.empty(),e("body").removeClass("modal-open")},e.fieldMedia.prototype.setValue=function(e){this.$input.val(e).trigger("change"),this.updatePreview()},e.fieldMedia.prototype.clearValue=function(){this.setValue("")},e.fieldMedia.prototype.updatePreview=function(){if(this.options.preview&&this.options.preview){this.$containerPreview.popover("dispose"),this.$input.tooltip("dispose");var e=this.$input.val();if(e){var t=new Image(this.options.previewWidth,this.options.previewHeight);t.src=this.options.basepath+e,this.$containerPreview.popover({content:t}),this.$input.tooltip({placement:"top",title:e})}else this.$containerPreview.popover()}},e.fieldMedia.defaults={basepath:"",rootFolder:"",buttonClear:".button-clear",buttonSelect:".button-select",buttonSaveSelected:".button-save-selected",input:".field-media-input",preview:!0,previewAsTooltip:!0,previewContainer:".field-media-preview",previewWidth:200,previewHeight:200,url:"index.php?option=com_media&tmpl=component",modal:".modal",modalWidth:"100%",modalHeight:"300px"},e.fn.fieldMedia=function(t){return this.each(function(){var t=e(this),i=t.data("fieldMedia");if(!i){var o=o||{},n=t.data();for(var a in n)n.hasOwnProperty(a)&&(o[a]=n[a]);i=new e.fieldMedia(this,o),t.data("fieldMedia",i)}})},e(document).ready(function(){e(".field-media-wrapper").fieldMedia()})}(jQuery);