!function(e){e.JSortableList=function(r,t,o,a,s,i){var n=this;"desc"!=o&&(o="asc");var d=e.extend({orderingIcon:"add-on",orderingWrapper:"input-prepend",orderingGroup:"sortable-group-id",sortableClassName:"dndlist-sortable",placeHolderClassName:"dnd-list-highlight dndlist-place-holder",sortableHandle:".sortable-handler"},s);e("tr",r).removeClass(d.sortableClassName).addClass(d.sortableClassName),e(r).parents("table").css("position","relative"),e(d.sortableHandle,r).css("cursor","move"),e("#"+t).attr("autocomplete","off");var l=e(d.sortableHandle,e(r)).length>0?d.sortableHandle:"";e(r).sortable({axis:"y",cursor:"move",handle:l,items:"tr."+d.sortableClassName,placeholder:d.placeHolderClassName,helper:function(r,t){return e(t).css({left:"0px"}),t.children().each(function(){e(this).width(e(this).width())}),e(t).children("td").addClass("dndlist-dragged-row"),t},start:function(t,o){n.sortableGroupId=o.item.attr(d.orderingGroup),n.sortableGroupId?n.sortableRange=e("tr["+d.orderingGroup+"="+n.sortableGroupId+"]"):n.sortableRange=e("."+d.sortableClassName),n.disableOtherGroupSort(t,o),i&&(n.hideChildrenNodes(o.item.attr("item-id")),n.hideSameLevelChildrenNodes(o.item.attr("level")),e(r).sortable("refresh"))},stop:function(o,s){if(e("td",e(this)).removeClass("dndlist-dragged-row"),e(s.item).css({opacity:0}),e(s.item).animate({opacity:1},800,function(){e(s.item).css("opacity","")}),n.enableOtherGroupSort(o,s),n.rearrangeOrderingValues(n.sortableGroupId,s),a){n.cloneMarkedCheckboxes();var d=e("#"+t),l=e('input[name|="task"]',d);l.length&&l.detach(),e.post(a,d.serialize()),l.length&&l.appendTo(d),n.removeClonedCheckboxes()}n.disabledOrderingElements="",i&&(n.showChildrenNodes(s.item),n.showSameLevelChildrenNodes(s.item),e(r).sortable("refresh"))}}),this.hideChildrenNodes=function(e){n.childrenNodes=n.getChildrenNodes(e),n.childrenNodes.hide()},this.showChildrenNodes=function(e){e.after(n.childrenNodes),n.childrenNodes.show(),n.childrenNodes=""},this.hideSameLevelChildrenNodes=function(r){n.sameLevelNodes=n.getSameLevelNodes(r),n.sameLevelNodes.each(function(){_childrenNodes=n.getChildrenNodes(e(this).attr("item-id")),_childrenNodes.addClass("child-nodes-tmp-hide"),_childrenNodes.hide()})},this.showSameLevelChildrenNodes=function(r){prevItem=r.prev(),prevItemChildrenNodes=n.getChildrenNodes(prevItem.attr("item-id")),prevItem.after(prevItemChildrenNodes),e("tr.child-nodes-tmp-hide").show().removeClass("child-nodes-tmp-hide"),n.sameLevelNodes=""},this.disableOtherGroupSort=function(t,o){if(n.sortableGroupId){e("tr["+d.orderingGroup+"!="+n.sortableGroupId+"]",e(r)).removeClass(d.sortableClassName).addClass("dndlist-group-disabled"),e(r).sortable("refresh")}},this.enableOtherGroupSort=function(t,o){e("tr",e(r)).removeClass(d.sortableClassName).addClass(d.sortableClassName).removeClass("dndlist-group-disabled"),e(r).sortable("refresh")},this.disableOrderingControl=function(){e("."+d.orderingWrapper+" .add-on a",n.sortableRange).hide()},this.enableOrderingControl=function(){e("."+d.orderingWrapper+" .add-on a",n.disabledOrderingElements).show()},this.rearrangeOrderingControl=function(r,t){var o;n.sortableRange=e(r?"tr["+d.orderingGroup+"="+r+"]":"."+d.sortableClassName);var a=(o=n.sortableRange).length;a>1&&(o.each(function(){var r=e("."+d.orderingWrapper+" .add-on:first a",e(this)),t=e("."+d.orderingWrapper+" .add-on:last a",e(this));r.get(0)&&t.get(0)||(r.get(0)?(r.removeAttr("title"),t=(t=(r=e("."+d.orderingWrapper+" .add-on:first",e(this)).html()).replace("icon-uparrow","icon-downarrow")).replace(".orderup",".orderdown"),e("."+d.orderingWrapper+" .add-on:last",e(this)).html(t)):t.get(0)&&(t.removeAttr("title"),r=(r=(t=e("."+d.orderingWrapper+" .add-on:last",e(this)).html()).replace("icon-downarrow","icon-uparrow")).replace(".orderdown",".orderup"),e("."+d.orderingWrapper+" .add-on:first",e(this)).html(r)))}),e("."+d.orderingWrapper+" .add-on:first a",o[0]).remove(),e("."+d.orderingWrapper+" .add-on:last a",o[a-1]).remove())},this.rearrangeOrderingValues=function(r,t){var a;n.sortableRange=e(r?"tr["+d.orderingGroup+"="+r+"]":"."+d.sortableClassName);(a=n.sortableRange).length>1&&(t.originalPosition.top>t.position.top?(t.item.position().top!=t.originalPosition.top&&e('[name="order[]"]',t.item).attr("value",parseInt(e("[type=text]",t.item.next()).attr("value"))),e(a).each(function(){var r=e(this).position().top;if(t.item.get(0)!==e(this).get(0)&&r>t.item.position().top&&r<t.originalPosition.top+t.item.outerHeight()){if("asc"==o)a=parseInt(e('[name="order[]"]',e(this)).attr("value"))+1;else var a=parseInt(e('[name="order[]"]',e(this)).attr("value"))-1;e('[name="order[]"]',e(this)).attr("value",a)}})):t.originalPosition.top<t.position.top&&(t.item.position().top!=t.originalPosition.top&&e('[name="order[]"]',t.item).attr("value",parseInt(e('[name="order[]"]',t.item.prev()).attr("value"))),e(a).each(function(){var r=e(this).position().top;if(t.item.get(0)!==e(this).get(0)&&r<t.item.position().top&&r>=t.originalPosition.top){if("asc"==o)a=parseInt(e('[name="order[]"]',e(this)).attr("value"))-1;else var a=parseInt(e('[name="order[]"]',e(this)).attr("value"))+1;e('[name="order[]"]',e(this)).attr("value",a)}})))},this.cloneMarkedCheckboxes=function(){e('[name="order[]"]',e(r)).attr("name","order-tmp"),e("[type=checkbox]",n.sortableRange).each(function(){var r=e(this).clone();e(r).attr({checked:"checked",shadow:"shadow",id:""}),e("#"+t).append(e(r)),e('[name="order-tmp"]',e(this).parents("tr")).attr("name","order[]")})},this.removeClonedCheckboxes=function(){e("[shadow=shadow]").remove(),e('[name="order-tmp"]',e(r)).attr("name","order[]")},this.getChildrenNodes=function(r){return e('tr[parents~="'+r+'"]')},this.getSameLevelNodes=function(r){return e("tr[level="+r+"]")}}}(jQuery),jQuery(document).ready(function(e){if(Joomla.getOptions("sortable-list")){var r=Joomla.getOptions("sortable-list");new e.JSortableList(r.id,r.formId,r.direction,r.url,r.options,r.nestedList);if("true"===r.button){var t=e(".saveorder");t.css({opacity:"0.2",cursor:"default"}).attr("onclick","return false;");var o="";e(".text-area-order").focus(function(){o=e(this).attr("value")}).keyup(function(){var r=e(this).attr("value");o!=r&&t.css({opacity:"1",cursor:"pointer"}).removeAttr("onclick")})}}});