const Joomla=window.Joomla||{};if(Joomla.selectedFile={},window.document.addEventListener('onMediaFileSelected',a=>{Joomla.selectedFile=a.detail}),Joomla.doIt=function(a,b,c){'use strict';if(!0===a.success){if(!a.data[0].url)Joomla.selectedFile.url=!1;else if(/local-/.test(a.data[0].adapter)){var d=Joomla.getOptions('system.paths').rootFull;Joomla.selectedFile.url=a.data[0].url.split(d)[1],Joomla.selectedFile.thumb=!!a.data[0].thumb_path&&a.data[0].thumb_path}else a.data[0].thumb_path&&(Joomla.selectedFile.thumb=a.data[0].thumb_path);const f=g=>{return'object'==typeof HTMLElement?g instanceof HTMLElement:g&&'object'==typeof g&&null!==g&&1===g.nodeType&&'string'==typeof g.nodeName};Joomla.selectedFile.url&&(f(b)||'object'==typeof b?!f(b)&&'object'==typeof b&&b.id?parent.window.Joomla.editors.instances[b.id].replaceSelection('<img src="'+Joomla.selectedFile.url+'" alt=""/>'):(b.value=Joomla.selectedFile.url,c.updatePreview()):Joomla.editors.instances[b].replaceSelection('<img src="'+Joomla.selectedFile.url+'" alt=""/>'))}},Joomla.getImage=function(a,b,c){return new Promise((d,f)=>{var g=Joomla.getOptions('csrf.token'),h=Joomla.getOptions('system.paths').rootFull+'administrator/index.php?option=com_media&format=json';Joomla.request({url:h+'&task=api.files&url=true&path='+a.path+'&'+g+'=1&format=json',method:'GET',perform:!0,headers:{'Content-Type':'application/json'},onSuccess:function(i){const j=JSON.parse(i);d(Joomla.doIt(j,b,c))},onError:function(){f()}})})},!document.head.querySelector('#joomla-modal-style')){const a=document.createElement('style');a.id='joomla-modal-style',a.innerHTML=`
joomla-field-media .field-media-preview {
	display: flex;
	align-items: center;
    justify-content: center;
	max-width: 336px;
	height: 180px !important;
	padding: 10px;
	background-color: #F2F2F2;
	border: 1px solid rgba(0, 0, 0, 0.15);
	border-width: 1px 1px 0 1px;
	border-radius: 0.25rem 0.25rem 0 0;
	overflow: hidden;
}
joomla-field-media .field-media-preview-icon {
	font-size: 5rem;
	opacity: .25;
}
joomla-field-media .field-media-input {
	border-top-left-radius: 0;
}
joomla-field-media .button-clear {
	border-top-right-radius: 0;
}
joomla-field-media img {
	max-height: 100%;
    max-width: 100%;
}

  `,document.head.appendChild(a)}class JoomlaFieldMedia extends HTMLElement{static get observedAttributes(){return['type','base-path','root-folder','url','modal-container','modal-width','modal-height','input','button-select','button-clear','button-save-selected','preview','preview-width','preview-height']}get type(){return this.getAttribute('type')}set type(a){this.setAttribute('type',a)}get basePath(){return this.getAttribute('base-path')}set basePath(a){this.setAttribute('base-path',a)}get rootFolder(){return this.getAttribute('root-folder')}set rootFolder(a){this.setAttribute('root-folder',a)}get url(){return this.getAttribute('url')}set url(a){this.setAttribute('url',a)}get modalContainer(){return this.getAttribute('modal-container')}set modalContainer(a){this.setAttribute('modal-container',a)}get input(){return this.getAttribute('input')}set input(a){this.setAttribute('input',a)}get buttonSelect(){return this.getAttribute('button-select')}set buttonSelect(a){this.setAttribute('button-select',a)}get buttonClear(){return this.getAttribute('button-clear')}set buttonClear(a){this.setAttribute('button-clear',a)}get buttonSaveSelected(){return this.getAttribute('button-save-selected')}set buttonSaveSelected(a){this.setAttribute('button-save-selected',a)}get modalWidth(){return this.getAttribute(parseInt('modal-width',10))}set modalWidth(a){this.setAttribute('modal-width',a)}get modalHeight(){return this.getAttribute(parseInt('modal-height',10))}set modalHeight(a){this.setAttribute('modal-height',a)}get previewWidth(){return this.getAttribute(parseInt('preview-width',10))}set previewWidth(a){this.setAttribute('preview-width',a)}get previewHeight(){return this.getAttribute(parseInt('preview-height',10))}set previewHeight(a){this.setAttribute('preview-height',a)}get preview(){return this.getAttribute('preview')}set preview(a){this.setAttribute('preview',a)}get previewContainer(){return this.getAttribute('preview-container')}connectedCallback(){console.log(this.buttonClear);const a=this.querySelector(this.buttonSelect),b=this.querySelector(this.buttonClear);this.show=this.show.bind(this),this.modalClose=this.modalClose.bind(this),this.clearValue=this.clearValue.bind(this),this.setValue=this.setValue.bind(this),this.updatePreview=this.updatePreview.bind(this),a.addEventListener('click',this.show),b&&b.addEventListener('click',this.clearValue),this.updatePreview()}disconnectedCallback(){const a=this.querySelector(this.buttonClear);a.removeEventListener('click',self)}show(){const a=this,b=this.querySelector(this.input);window.jQuery(this.querySelector('[role="dialog"]')).modal('show'),window.jQuery(this.querySelector(this.buttonSaveSelected)).on('click',c=>{return c.preventDefault(),c.stopPropagation(),this.selectedPath&&a.setValue(this.selectedPath),a.modalClose(),!1})}modalClose(){const a=this.querySelector(this.input);console.log(this),Joomla.getImage(Joomla.selectedFile,a,this),window.jQuery(this.querySelector('[role="dialog"]')).modal('hide')}setValue(a){const b=window.jQuery(this.querySelector(this.input));b.val(a).trigger('change'),this.updatePreview()}clearValue(){this.setValue('')}updatePreview(){if(-1!==['true','static'].indexOf(this.preview)&&'false'!==this.preview&&this.preview){const a=this.querySelector(this.input),b=a.value,c=this.querySelector('.field-media-preview');if(!b)c.innerHTML='<span class="field-media-preview-icon fa fa-picture-o"></span>';else{c.innerHTML='';const d=new Image;switch(this.type){case'image':d.src=d.src=/http/.test(b)?b:'/'+b;break;default:}c.style.width=this.previewWidth,c.appendChild(d)}}}}customElements.define('joomla-field-media',JoomlaFieldMedia);