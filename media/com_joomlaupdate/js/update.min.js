function error_callback(a){alert("ERROR:\n"+a)}function empty(a){var b;if(""===a||0===a||"0"===a||null===a||a===!1||"undefined"==typeof a)return!0;if("object"==typeof a){for(b in a)return!1;return!0}return!1}function is_array(a){var b="",c=function(a){var b=/\W*function\s+([\w\$]+)\s*\(/.exec(a);return b?b[1]:"(Anonymous)"};if(!a)return!1;if(this.php_js=this.php_js||{},this.php_js.ini=this.php_js.ini||{},"object"==typeof a){if(this.php_js.ini["phpjs.objectsAsArrays"]&&(this.php_js.ini["phpjs.objectsAsArrays"].local_value.toLowerCase&&"off"===this.php_js.ini["phpjs.objectsAsArrays"].local_value.toLowerCase()||0===parseInt(this.php_js.ini["phpjs.objectsAsArrays"].local_value,10)))return a.hasOwnProperty("length")&&!a.propertyIsEnumerable("length")&&"String"!==c(a.constructor);if(a.hasOwnProperty)for(b in a)if(!1===a.hasOwnProperty(b))return!1;return!0}return!1}var stat_total=0,stat_files=0,stat_inbytes=0,stat_outbytes=0;doEncryptedAjax=function(a,b,c){var d=JSON.stringify(a);joomlaupdate_password.length>0&&(d=AesCtr.encrypt(d,joomlaupdate_password,128));var e={json:d},f={type:"POST",url:joomlaupdate_ajax_url,cache:!1,data:e,timeout:6e5,success:function(a,d){var e=null,f="",g=a.indexOf("###");if(g==-1)return a="Invalid AJAX data:\n"+a,void(null==c?null!=error_callback&&error_callback(a):c(a));0!=g?(e=a.substr(0,g),f=a.substr(g)):f=a,f=f.substr(3);var g=f.lastIndexOf("###");f=f.substr(0,g);var h=null;if(joomlaupdate_password.length>0)try{var h=JSON.parse(f)}catch(a){f=AesCtr.decrypt(f,joomlaupdate_password,128)}try{empty(h)&&(h=JSON.parse(f))}catch(b){var a=b.message+"\n<br/>\n<pre>\n"+f+"\n</pre>";return void(null==c?null!=error_callback&&error_callback(a):c(a))}b(h)},error:function(a){var b="AJAX Loading Error: "+a.statusText;null==c?null!=error_callback&&error_callback(b):c(b)}};jQuery.ajax(f)},pingExtract=function(){this.stat_files=0,this.stat_inbytes=0,this.stat_outbytes=0;var a={task:"ping"};this.doEncryptedAjax(a,function(a){startExtract(a)})},startExtract=function(){console.log("started"),this.stat_files=0,this.stat_inbytes=0,this.stat_outbytes=0;var a={task:"startRestore"};this.doEncryptedAjax(a,function(a){stepExtract(a)})},stepExtract=function(a){return 0==a.status?void error_callback(a.message):(!empty(a.Warnings),empty(a.factory)||(extract_factory=a.factory),void(a.done?finalizeUpdate():(stat_inbytes+=a.bytesIn,stat_percent=100*stat_inbytes/joomlaupdate_totalsize,stat_inbytes+=a.bytesIn,stat_outbytes+=a.bytesOut,stat_files+=a.files,stat_percent<100?jQuery("#progress-bar").css("width",stat_percent+"%").attr("aria-valuenow",stat_percent):stat_percent>100?(stat_percent=100,jQuery("#progress-bar").css("width",stat_percent+"%").attr("aria-valuenow",stat_percent)):jQuery("#progress-bar").removeClass("bar-success"),jQuery("#extpercent").text(stat_percent.toFixed(1)),jQuery("#extbytesin").text(stat_inbytes),jQuery("#extbytesout").text(stat_outbytes),jQuery("#extfiles").text(a.lastfile),post={task:"stepRestore",factory:a.factory},doEncryptedAjax(post,function(a){stepExtract(a)}))))},finalizeUpdate=function(){var a={task:"finalizeRestore",factory:window.factory};doEncryptedAjax(a,function(a){window.location=joomlaupdate_return_url})};