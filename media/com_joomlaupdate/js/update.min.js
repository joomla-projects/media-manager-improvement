function error_callback(a){alert("ERROR:\n"+a)}function empty(a){var b;if(""===a||0===a||"0"===a||null===a||a===!1||void 0===a)return!0;if("object"==typeof a){for(b in a)return!1;return!0}return!1}function is_array(a){var b="";if(!a)return!1;if(this.php_js=this.php_js||{},this.php_js.ini=this.php_js.ini||{},"object"==typeof a){if(this.php_js.ini["phpjs.objectsAsArrays"]&&(this.php_js.ini["phpjs.objectsAsArrays"].local_value.toLowerCase&&"off"===this.php_js.ini["phpjs.objectsAsArrays"].local_value.toLowerCase()||0===parseInt(this.php_js.ini["phpjs.objectsAsArrays"].local_value,10)))return a.hasOwnProperty("length")&&!a.propertyIsEnumerable("length")&&"String"!==function(a){var b=/\W*function\s+([\w\$]+)\s*\(/.exec(a);return b?b[1]:"(Anonymous)"}(a.constructor);if(a.hasOwnProperty)for(b in a)if(!1===a.hasOwnProperty(b))return!1;return!0}return!1}var stat_total=0,stat_files=0,stat_inbytes=0,stat_outbytes=0;doEncryptedAjax=function(a,b,c){var d=JSON.stringify(a);joomlaupdate_password.length>0&&(d=AesCtr.encrypt(d,joomlaupdate_password,128));var e={json:d},f={type:"POST",url:joomlaupdate_ajax_url,cache:!1,data:e,timeout:6e5,success:function(a,d){var e="",f=a.indexOf("###");if(f==-1)return a="Invalid AJAX data:\n"+a,void(null==c?null!=error_callback&&error_callback(a):c(a));0!=f?(a.substr(0,f),e=a.substr(f)):e=a,e=e.substr(3);var f=e.lastIndexOf("###");e=e.substr(0,f);var g=null;if(joomlaupdate_password.length>0)try{var g=JSON.parse(e)}catch(a){e=AesCtr.decrypt(e,joomlaupdate_password,128)}try{empty(g)&&(g=JSON.parse(e))}catch(b){var a=b.message+"\n<br/>\n<pre>\n"+e+"\n</pre>";return void(null==c?null!=error_callback&&error_callback(a):c(a))}b(g)},error:function(a){var b="AJAX Loading Error: "+a.statusText;null==c?null!=error_callback&&error_callback(b):c(b)}};jQuery.ajax(f)},pingExtract=function(){this.stat_files=0,this.stat_inbytes=0,this.stat_outbytes=0;var a={task:"ping"};this.doEncryptedAjax(a,function(a){startExtract(a)})},startExtract=function(){console.log("started"),this.stat_files=0,this.stat_inbytes=0,this.stat_outbytes=0;var a={task:"startRestore"};this.doEncryptedAjax(a,function(a){stepExtract(a)})},stepExtract=function(a){if(0==a.status)return void error_callback(a.message);empty(a.Warnings),empty(a.factory)||(extract_factory=a.factory),a.done?finalizeUpdate():(stat_inbytes+=a.bytesIn,stat_percent=100*stat_inbytes/joomlaupdate_totalsize,stat_inbytes+=a.bytesIn,stat_outbytes+=a.bytesOut,stat_files+=a.files,stat_percent<100?jQuery("#progress-bar").css("width",stat_percent+"%").attr("aria-valuenow",stat_percent):stat_percent>100?(stat_percent=100,jQuery("#progress-bar").css("width",stat_percent+"%").attr("aria-valuenow",stat_percent)):jQuery("#progress-bar").removeClass("bar-success"),jQuery("#extpercent").text(stat_percent.toFixed(1)),jQuery("#extbytesin").text(stat_inbytes),jQuery("#extbytesout").text(stat_outbytes),jQuery("#extfiles").text(a.lastfile),post={task:"stepRestore",factory:a.factory},doEncryptedAjax(post,function(a){stepExtract(a)}))},finalizeUpdate=function(){var a={task:"finalizeRestore",factory:window.factory};doEncryptedAjax(a,function(a){window.location=joomlaupdate_return_url})};