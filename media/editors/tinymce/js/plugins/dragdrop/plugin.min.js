tinymce.PluginManager.add("jdragdrop",function(a){function b(b){var c=new FormData;c.append("Filedata",b),c.append("folder",tinyMCE.activeEditor.settings.mediaUploadPath);var d=new XMLHttpRequest;d.upload.onprogress=function(a){var b=a.loaded/a.total*100;document.querySelector(".bar").style.width=b+"%"},removeProgessBar=function(){setTimeout(function(){var b=document.querySelector("#jloader");b.parentNode.removeChild(b),a.contentAreaContainer.style.borderWidth="1px 0 0 0"},200)},d.onload=function(){var b=JSON.parse(d.responseText);if(200==d.status){if("0"==b.status&&(removeProgessBar(),a.windowManager.alert(b.message+": "+setCustomDir+b.location)),"1"==b.status){removeProgessBar();var c=tinyMCE.activeEditor.getDoc().createElement("img");c.src=tinyMCE.activeEditor.settings.setCustomDir+b.location,tinyMCE.activeEditor.execCommand("mceInsertContent",!1,c.outerHTML)}}else removeProgessBar()},d.onerror=function(){removeProgessBar()},d.open("POST",tinyMCE.activeEditor.settings.uploadUri,!0),d.send(c)}tinyMCE.DOM.bind(document,"dragleave",function(a){return a.stopPropagation(),a.preventDefault(),tinyMCE.activeEditor.contentAreaContainer.style.borderWidth="1px 0 0",!1}),"undefined"!=typeof FormData?(a.on("dragenter",function(a){return a.stopPropagation(),!1}),a.on("dragover",function(b){return b.preventDefault(),a.contentAreaContainer.style.borderStyle="dashed",a.contentAreaContainer.style.borderWidth="5px",!1}),a.on("drop",function(c){if(c.dataTransfer&&c.dataTransfer.files&&c.dataTransfer.files.length>0)for(var e,d=0;e=c.dataTransfer.files[d];d++){if(e.name.toLowerCase().match(/\.(jpg|jpeg|png|gif)$/)){var f,g,h="";f=document.createElement("div"),f.id="jloader",g=document.createElement("div"),g.classList.add("progress"),g.classList.add("progress-success"),g.classList.add("progress-striped"),g.classList.add("active"),g.style.width="100%",g.style.height="30px",h=document.createElement("div"),h.classList.add("bar"),h.style.width="0",g.appendChild(h),f.appendChild(g),document.querySelector(".mce-toolbar-grp").appendChild(f),b(e)}c.preventDefault()}a.contentAreaContainer.style.borderWidth="1px 0 0"})):(Joomla.renderMessages({error:[Joomla.JText._("PLG_TINY_ERR_UNSUPPORTEDBROWSER")]}),a.on("drop",function(a){return a.preventDefault(),!1}))});