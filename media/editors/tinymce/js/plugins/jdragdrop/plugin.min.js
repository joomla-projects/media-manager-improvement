tinymce.PluginManager.add("jdragdrop",function(a){function b(b){var c=new FormData;c.append("Filedata",b),c.append("folder",mediaUploadPath);var d=new XMLHttpRequest;d.upload.onprogress=function(a){var b=a.loaded/a.total*100;document.querySelector(".bar").style.width=b+"%"},removeProgessBar=function(){setTimeout(function(){document.querySelector("#jloader").outerHTML="",delete document.querySelector("#jloader"),a.contentAreaContainer.style.borderWidth=""},200)},d.onload=function(){var a=JSON.parse(d.responseText);if(200==d.status){if("0"==a.status&&(removeProgessBar(),tinyMCE.activeEditor.windowManager.alert(a.message+": "+setCustomDir+a.location)),"1"==a.status){removeProgessBar();var b=tinyMCE.activeEditor.getDoc().createElement("img");b.src=setCustomDir+a.location,tinyMCE.activeEditor.execCommand("mceInsertContent",!1,b.outerHTML)}}else removeProgessBar()},d.onerror=function(){removeProgessBar()},d.open("POST",uploadUri,!0),d.send(c)}tinyMCE.DOM.bind(document,"dragleave",function(a){return a.stopPropagation(),a.preventDefault(),tinyMCE.activeEditor.contentAreaContainer.style.borderWidth="",!1}),"undefined"!=typeof FormData?(a.on("dragenter",function(a){return a.stopPropagation(),!1}),a.on("dragover",function(a){return a.preventDefault(),tinyMCE.activeEditor.contentAreaContainer.style.borderStyle="dashed",tinyMCE.activeEditor.contentAreaContainer.style.borderWidth="5px",!1}),a.on("drop",function(c){if(c.dataTransfer&&c.dataTransfer.files&&c.dataTransfer.files.length>0)for(var e,d=0;e=c.dataTransfer.files[d];d++)e.name.toLowerCase().match(/\.(jpg|jpeg|png|gif)$/)&&(document.querySelector(".mce-toolbar-grp").innerHTML+='<div id="jloader">   <div class="progress progress-success progress-striped active" style="width:100%;height:30px;">       <div class="bar" style="width: 0%"></div>   </div></div>',a.contentAreaContainer.style.borderWidth="",b(e)),c.preventDefault();a.contentAreaContainer.style.borderWidth=""})):(Joomla.renderMessages({error:[Joomla.JText._("PLG_TINY_ERR_UNSUPPORTEDBROWSER")]}),a.on("drop",function(a){return a.preventDefault(),!1}))});