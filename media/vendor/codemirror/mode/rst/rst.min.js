!function(a){"object"==typeof exports&&"object"==typeof module?a(require("../../lib/codemirror"),require("../python/python"),require("../stex/stex"),require("../../addon/mode/overlay")):"function"==typeof define&&define.amd?define(["../../lib/codemirror","../python/python","../stex/stex","../../addon/mode/overlay"],a):a(CodeMirror)}(function(a){"use strict";a.defineMode("rst",function(b,c){var d=/^\*\*[^\*\s](?:[^\*]*[^\*\s])?\*\*/,e=new RegExp("^[Hh][Tt][Tt][Pp][Ss]?://(?:[\\d\\w.-]+)\\.(?:\\w{2,6})(?:/[\\d\\w\\#\\%\\&\\-\\.\\,\\/\\:\\=\\?\\~]+)*"),f={token:function(a){if(a.match(d)&&a.match(/\W+|$/,!1))return"strong";if(a.match(/^\*[^\*\s](?:[^\*]*[^\*\s])?\*/)&&a.match(/\W+|$/,!1))return"em";if(a.match(/^``[^`\s](?:[^`]*[^`\s])``/)&&a.match(/\W+|$/,!1))return"string-2";if(a.match(/^(?:[\d]+(?:[\.,]\d+)*)/))return"number";if(a.match(/^(?:\s\+[\d]+(?:[\.,]\d+)*)/))return"positive";if(a.match(/^(?:\s\-[\d]+(?:[\.,]\d+)*)/))return"negative";if(a.match(e))return"link";for(;null!=a.next()&&!a.match(d,!1)&&!a.match(/^\*[^\*\s](?:[^\*]*[^\*\s])?\*/,!1)&&!a.match(/^``[^`\s](?:[^`]*[^`\s])``/,!1)&&!a.match(/^(?:[\d]+(?:[\.,]\d+)*)/,!1)&&!a.match(/^(?:\s\+[\d]+(?:[\.,]\d+)*)/,!1)&&!a.match(/^(?:\s\-[\d]+(?:[\.,]\d+)*)/,!1)&&!a.match(e,!1););return null}},g=a.getMode(b,c.backdrop||"rst-base");return a.overlayMode(g,f,!0)},"python","stex"),a.defineMode("rst-base",function(b){function c(a){var b=Array.prototype.slice.call(arguments,1);return a.replace(/{(\d+)}/g,function(a,c){return void 0!==b[c]?b[c]:a})}function d(b,c){var f=null;if(b.sol()&&b.match(W,!1))k(c,i,{mode:n,local:a.startState(n)});else if(b.sol()&&b.match(y))k(c,e),f="meta";else if(b.sol()&&b.match(x))k(c,d),f="header";else if(m(c)==J||b.match(J,!1))switch(l(c)){case 0:k(c,d,j(J,1)),b.match(/^:/),f="meta";break;case 1:k(c,d,j(J,2)),b.match(s),f="keyword",b.current().match(/^(?:math|latex)/)&&(c.tmp_stex=!0);break;case 2:k(c,d,j(J,3)),b.match(/^:`/),f="meta";break;case 3:if(c.tmp_stex&&(c.tmp_stex=void 0,c.tmp={mode:o,local:a.startState(o)}),c.tmp){if("`"==b.peek()){k(c,d,j(J,4)),c.tmp=void 0;break}f=c.tmp.mode.token(b,c.tmp.local);break}k(c,d,j(J,4)),b.match(w),f="string";break;case 4:k(c,d,j(J,5)),b.match(/^`/),f="meta";break;case 5:k(c,d,j(J,6)),b.match(q);break;default:k(c,d)}else if(m(c)==K||b.match(K,!1))switch(l(c)){case 0:k(c,d,j(K,1)),b.match(/^`/),f="meta";break;case 1:k(c,d,j(K,2)),b.match(w),f="string";break;case 2:k(c,d,j(K,3)),b.match(/^`:/),f="meta";break;case 3:k(c,d,j(K,4)),b.match(s),f="keyword";break;case 4:k(c,d,j(K,5)),b.match(/^:/),f="meta";break;case 5:k(c,d,j(K,6)),b.match(q);break;default:k(c,d)}else if(m(c)==L||b.match(L,!1))switch(l(c)){case 0:k(c,d,j(L,1)),b.match(/^:/),f="meta";break;case 1:k(c,d,j(L,2)),b.match(s),f="keyword";break;case 2:k(c,d,j(L,3)),b.match(/^:/),f="meta";break;case 3:k(c,d,j(L,4)),b.match(q);break;default:k(c,d)}else if(m(c)==E||b.match(E,!1))switch(l(c)){case 0:k(c,d,j(E,1)),b.match(O),f="variable-2";break;case 1:k(c,d,j(E,2)),b.match(/^_?_?/)&&(f="link");break;default:k(c,d)}else if(b.match(F))k(c,d),f="quote";else if(b.match(G))k(c,d),f="quote";else if(b.match(H))k(c,d),b.peek()&&!b.peek().match(/^\W$/)||(f="link");else if(m(c)==I||b.match(I,!1))switch(l(c)){case 0:!b.peek()||b.peek().match(/^\W$/)?k(c,d,j(I,1)):b.match(I);break;case 1:k(c,d,j(I,2)),b.match(/^`/),f="link";break;case 2:k(c,d,j(I,3)),b.match(w);break;case 3:k(c,d,j(I,4)),b.match(/^`_/),f="link";break;default:k(c,d)}else b.match(V)?k(c,g):b.next()&&k(c,d);return f}function e(b,c){var g=null;if(m(c)==B||b.match(B,!1))switch(l(c)){case 0:k(c,e,j(B,1)),b.match(O),g="variable-2";break;case 1:k(c,e,j(B,2)),b.match(P);break;case 2:k(c,e,j(B,3)),b.match(Q),g="keyword";break;case 3:k(c,e,j(B,4)),b.match(R),g="meta";break;default:k(c,d)}else if(m(c)==A||b.match(A,!1))switch(l(c)){case 0:k(c,e,j(A,1)),b.match(M),g="keyword",b.current().match(/^(?:math|latex)/)?c.tmp_stex=!0:b.current().match(/^python/)&&(c.tmp_py=!0);break;case 1:k(c,e,j(A,2)),b.match(N),g="meta",(b.match(/^latex\s*$/)||c.tmp_stex)&&(c.tmp_stex=void 0,k(c,i,{mode:o,local:a.startState(o)}));break;case 2:k(c,e,j(A,3)),(b.match(/^python\s*$/)||c.tmp_py)&&(c.tmp_py=void 0,k(c,i,{mode:n,local:a.startState(n)}));break;default:k(c,d)}else if(m(c)==z||b.match(z,!1))switch(l(c)){case 0:k(c,e,j(z,1)),b.match(S),b.match(T),g="link";break;case 1:k(c,e,j(z,2)),b.match(U),g="meta";break;default:k(c,d)}else b.match(C)?(k(c,d),g="quote"):b.match(D)?(k(c,d),g="quote"):(b.eatSpace(),b.eol()?k(c,d):(b.skipToEnd(),k(c,f),g="comment"));return g}function f(a,b){return h(a,b,"comment")}function g(a,b){return h(a,b,"meta")}function h(a,b,c){return a.eol()||a.eatSpace()?(a.skipToEnd(),c):(k(b,d),null)}function i(a,b){return b.ctx.mode&&b.ctx.local?a.sol()?(a.eatSpace()||k(b,d),null):b.ctx.mode.token(a,b.ctx.local):(k(b,d),null)}function j(a,b,c,d){return{phase:a,stage:b,mode:c,local:d}}function k(a,b,c){a.tok=b,a.ctx=c||{}}function l(a){return a.ctx.stage||0}function m(a){return a.ctx.phase}var n=a.getMode(b,"python"),o=a.getMode(b,"stex"),p="(?:\\s*|\\W|$)",q=new RegExp(c("^{0}",p)),r="(?:[^\\W\\d_](?:[\\w!\"#$%&'()\\*\\+,\\-\\./:;<=>\\?]*[^\\W_])?)",s=new RegExp(c("^{0}",r)),t=c("(?:{0}|`{1}`)",r,"(?:[^\\W\\d_](?:[\\w\\s!\"#$%&'()\\*\\+,\\-\\./:;<=>\\?]*[^\\W_])?)"),u="(?:[^\\s\\|](?:[^\\|]*[^\\s\\|])?)",v="(?:[^\\`]+)",w=new RegExp(c("^{0}",v)),x=new RegExp("^([!'#$%&\"()*+,-./:;<=>?@\\[\\\\\\]^_`{|}~])\\1{3,}\\s*$"),y=new RegExp(c("^\\.\\.{0}","\\s+")),z=new RegExp(c("^_{0}:{1}|^__:{1}",t,p)),A=new RegExp(c("^{0}::{1}",t,p)),B=new RegExp(c("^\\|{0}\\|{1}{2}::{3}",u,"\\s+",t,p)),C=new RegExp(c("^\\[(?:\\d+|#{0}?|\\*)]{1}",t,p)),D=new RegExp(c("^\\[{0}\\]{1}",t,p)),E=new RegExp(c("^\\|{0}\\|",u)),F=new RegExp(c("^\\[(?:\\d+|#{0}?|\\*)]_",t)),G=new RegExp(c("^\\[{0}\\]_",t)),H=new RegExp(c("^{0}__?",t)),I=new RegExp(c("^`{0}`_",v)),J=new RegExp(c("^:{0}:`{1}`{2}",r,v,p)),K=new RegExp(c("^`{1}`:{0}:{2}",r,v,p)),L=new RegExp(c("^:{0}:{1}",r,p)),M=new RegExp(c("^{0}",t)),N=new RegExp(c("^::{0}",p)),O=new RegExp(c("^\\|{0}\\|",u)),P=new RegExp(c("^{0}","\\s+")),Q=new RegExp(c("^{0}",t)),R=new RegExp(c("^::{0}",p)),S=new RegExp("^_"),T=new RegExp(c("^{0}|_",t)),U=new RegExp(c("^:{0}",p)),V=new RegExp("^::\\s*$"),W=new RegExp("^\\s+(?:>>>|In \\[\\d+\\]:)\\s");return{startState:function(){return{tok:d,ctx:j(void 0,0)}},copyState:function(b){var c=b.ctx,d=b.tmp;return c.local&&(c={mode:c.mode,local:a.copyState(c.mode,c.local)}),d&&(d={mode:d.mode,local:a.copyState(d.mode,d.local)}),{tok:b.tok,ctx:c,tmp:d}},innerMode:function(a){return a.tmp?{state:a.tmp.local,mode:a.tmp.mode}:a.ctx.mode?{state:a.ctx.local,mode:a.ctx.mode}:null},token:function(a,b){return b.tok(a,b)}}},"python","stex"),a.defineMIME("text/x-rst","rst")});