!function(t){"object"==typeof exports&&"object"==typeof module?t(require("../../lib/codemirror"),require("../javascript/javascript"),require("../css/css"),require("../htmlmixed/htmlmixed")):"function"==typeof define&&define.amd?define(["../../lib/codemirror","../javascript/javascript","../css/css","../htmlmixed/htmlmixed"],t):t(CodeMirror)}(function(t){"use strict";t.defineMode("pug",function(e){var i="keyword",n="meta",r="builtin",a="qualifier",s={"{":"}","(":")","[":"]"},c=t.getMode(e,"javascript");function o(){this.javaScriptLine=!1,this.javaScriptLineExcludesColon=!1,this.javaScriptArguments=!1,this.javaScriptArgumentsDepth=0,this.isInterpolating=!1,this.interpolationNesting=0,this.jsState=t.startState(c),this.restOfLine="",this.isIncludeFiltered=!1,this.isEach=!1,this.lastTag="",this.scriptType="",this.isAttrs=!1,this.attrsNest=[],this.inAttributeName=!0,this.attributeIsType=!1,this.attrValue="",this.indentOf=1/0,this.indentToken="",this.innerMode=null,this.innerState=null,this.innerModeForLine=!1}o.prototype.copy=function(){var e=new o;return e.javaScriptLine=this.javaScriptLine,e.javaScriptLineExcludesColon=this.javaScriptLineExcludesColon,e.javaScriptArguments=this.javaScriptArguments,e.javaScriptArgumentsDepth=this.javaScriptArgumentsDepth,e.isInterpolating=this.isInterpolating,e.interpolationNesting=this.interpolationNesting,e.jsState=t.copyState(c,this.jsState),e.innerMode=this.innerMode,this.innerMode&&this.innerState&&(e.innerState=t.copyState(this.innerMode,this.innerState)),e.restOfLine=this.restOfLine,e.isIncludeFiltered=this.isIncludeFiltered,e.isEach=this.isEach,e.lastTag=this.lastTag,e.scriptType=this.scriptType,e.isAttrs=this.isAttrs,e.attrsNest=this.attrsNest.slice(),e.inAttributeName=this.inAttributeName,e.attributeIsType=this.attributeIsType,e.attrValue=this.attrValue,e.indentOf=this.indentOf,e.indentToken=this.indentToken,e.innerModeForLine=this.innerModeForLine,e};function u(t,e){if(t.match("#{"))return e.isInterpolating=!0,e.interpolationNesting=0,"punctuation"}function p(i,n){if(i.match(/^:([\w\-]+)/)){var r;return e&&e.innerModes&&(r=e.innerModes(i.current().substring(1))),r||(r=i.current().substring(1)),"string"==typeof r&&(r=t.getMode(e,r)),f(i,n,r),"atom"}}function f(i,n,r){r=t.mimeModes[r]||r,r=e.innerModes?e.innerModes(r)||r:r,r=t.mimeModes[r]||r,r=t.getMode(e,r),n.indentOf=i.indentation(),r&&"null"!==r.name?n.innerMode=r:n.indentToken="string"}function l(e,i,n){if(e.indentation()>i.indentOf||i.innerModeForLine&&!e.sol()||n)return i.innerMode?(i.innerState||(i.innerState=i.innerMode.startState?t.startState(i.innerMode,e.indentation()):{}),e.hideFirstChars(i.indentOf+2,function(){return i.innerMode.token(e,i.innerState)||!0})):(e.skipToEnd(),i.indentToken);e.sol()&&(i.indentOf=1/0,i.indentToken=null,i.innerMode=null,i.innerState=null)}return{startState:function(){return new o},copyState:function(t){return t.copy()},token:function(e,o){var h,d,m,v,S,g=l(e,o)||function(t,e){if(t.sol()&&(e.restOfLine=""),e.restOfLine){t.skipToEnd();var i=e.restOfLine;return e.restOfLine="",i}}(e,o)||function(t,e){if(e.isInterpolating){if("}"===t.peek()){if(e.interpolationNesting--,e.interpolationNesting<0)return t.next(),e.isInterpolating=!1,"punctuation"}else"{"===t.peek()&&e.interpolationNesting++;return c.token(t,e.jsState)||!0}}(e,o)||function(t,e){if(e.isIncludeFiltered){var i=p(t,e);return e.isIncludeFiltered=!1,e.restOfLine="string",i}}(e,o)||function(t,e){if(e.isEach){if(t.match(/^ in\b/))return e.javaScriptLine=!0,e.isEach=!1,i;if(t.sol()||t.eol())e.isEach=!1;else if(t.next()){for(;!t.match(/^ in\b/,!1)&&t.next(););return"variable"}}}(e,o)||function e(i,n){if(n.isAttrs){if(s[i.peek()]&&n.attrsNest.push(s[i.peek()]),n.attrsNest[n.attrsNest.length-1]===i.peek())n.attrsNest.pop();else if(i.eat(")"))return n.isAttrs=!1,"punctuation";if(n.inAttributeName&&i.match(/^[^=,\)!]+/))return"="!==i.peek()&&"!"!==i.peek()||(n.inAttributeName=!1,n.jsState=t.startState(c),"script"===n.lastTag&&"type"===i.current().trim().toLowerCase()?n.attributeIsType=!0:n.attributeIsType=!1),"attribute";var r=c.token(i,n.jsState);if(n.attributeIsType&&"string"===r&&(n.scriptType=i.current().toString()),0===n.attrsNest.length&&("string"===r||"variable"===r||"keyword"===r))try{return Function("","var x "+n.attrValue.replace(/,\s*$/,"").replace(/^!/,"")),n.inAttributeName=!0,n.attrValue="",i.backUp(i.current().length),e(i,n)}catch(t){}return n.attrValue+=i.current(),r||!0}}(e,o)||function(t,e){if(t.sol()&&(e.javaScriptLine=!1,e.javaScriptLineExcludesColon=!1),e.javaScriptLine){if(e.javaScriptLineExcludesColon&&":"===t.peek())return e.javaScriptLine=!1,void(e.javaScriptLineExcludesColon=!1);var i=c.token(t,e.jsState);return t.eol()&&(e.javaScriptLine=!1),i||!0}}(e,o)||function(t,e){if(e.javaScriptArguments)return 0===e.javaScriptArgumentsDepth&&"("!==t.peek()?void(e.javaScriptArguments=!1):("("===t.peek()?e.javaScriptArgumentsDepth++:")"===t.peek()&&e.javaScriptArgumentsDepth--,0===e.javaScriptArgumentsDepth?void(e.javaScriptArguments=!1):c.token(t,e.jsState)||!0)}(e,o)||function(t,e){if(e.mixinCallAfter)return e.mixinCallAfter=!1,t.match(/^\( *[-\w]+ *=/,!1)||(e.javaScriptArguments=!0,e.javaScriptArgumentsDepth=0),!0}(e,o)||function(t){if(t.match(/^yield\b/))return"keyword"}(e)||function(t){if(t.match(/^(?:doctype) *([^\n]+)?/))return n}(e)||u(e,o)||function(t,e){if(t.match(/^case\b/))return e.javaScriptLine=!0,i}(e,o)||function(t,e){if(t.match(/^when\b/))return e.javaScriptLine=!0,e.javaScriptLineExcludesColon=!0,i}(e,o)||function(t){if(t.match(/^default\b/))return i}(e)||function(t,e){if(t.match(/^extends?\b/))return e.restOfLine="string",i}(e,o)||function(t,e){if(t.match(/^append\b/))return e.restOfLine="variable",i}(e,o)||function(t,e){if(t.match(/^prepend\b/))return e.restOfLine="variable",i}(e,o)||function(t,e){if(t.match(/^block\b *(?:(prepend|append)\b)?/))return e.restOfLine="variable",i}(e,o)||function(t,e){if(t.match(/^include\b/))return e.restOfLine="string",i}(e,o)||function(t,e){if(t.match(/^include:([a-zA-Z0-9\-]+)/,!1)&&t.match("include"))return e.isIncludeFiltered=!0,i}(e,o)||function(t,e){if(t.match(/^mixin\b/))return e.javaScriptLine=!0,i}(e,o)||(v=e,S=o,v.match(/^\+([-\w]+)/)?(v.match(/^\( *[-\w]+ *=/,!1)||(S.javaScriptArguments=!0,S.javaScriptArgumentsDepth=0),"variable"):v.match(/^\+#{/,!1)?(v.next(),S.mixinCallAfter=!0,u(v,S)):void 0)||function(t,e){if(t.match(/^(if|unless|else if|else)\b/))return e.javaScriptLine=!0,i}(e,o)||function(t,e){if(t.match(/^(- *)?(each|for)\b/))return e.isEach=!0,i}(e,o)||function(t,e){if(t.match(/^while\b/))return e.javaScriptLine=!0,i}(e,o)||function(t,e){var i;if(i=t.match(/^(\w(?:[-:\w]*\w)?)\/?/))return e.lastTag=i[1].toLowerCase(),"script"===e.lastTag&&(e.scriptType="application/javascript"),"tag"}(e,o)||p(e,o)||function(t,e){if(t.match(/^(!?=|-)/))return e.javaScriptLine=!0,"punctuation"}(e,o)||function(t){if(t.match(/^#([\w-]+)/))return r}(e)||function(t){if(t.match(/^\.([\w-]+)/))return a}(e)||function(t,e){if("("==t.peek())return t.next(),e.isAttrs=!0,e.attrsNest=[],e.inAttributeName=!0,e.attrValue="",e.attributeIsType=!1,"punctuation"}(e,o)||function(t,e){if(t.match(/^&attributes\b/))return e.javaScriptArguments=!0,e.javaScriptArgumentsDepth=0,"keyword"}(e,o)||function(t){if(t.sol()&&t.eatSpace())return"indent"}(e)||(d=e,m=o,d.match(/^(?:\| ?| )([^\n]+)/)?"string":d.match(/^(<[^\n]*)/,!1)?(f(d,m,"htmlmixed"),m.innerModeForLine=!0,l(d,m,!0)):void 0)||function(t,e){if(t.match(/^ *\/\/(-)?([^\n]*)/))return e.indentOf=t.indentation(),e.indentToken="comment","comment"}(e,o)||function(t){if(t.match(/^: */))return"colon"}(e)||function(t,e){if(t.eat(".")){var i=null;return"script"===e.lastTag&&-1!=e.scriptType.toLowerCase().indexOf("javascript")?i=e.scriptType.toLowerCase().replace(/"|'/g,""):"style"===e.lastTag&&(i="css"),f(t,e,i),"dot"}}(e,o)||(h=e,h.next(),null);return!0===g?null:g}}},"javascript","css","htmlmixed"),t.defineMIME("text/x-pug","pug"),t.defineMIME("text/x-jade","pug")});