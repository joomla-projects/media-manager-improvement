!function(e){"object"==typeof exports&&"object"==typeof module?e(require("../../lib/codemirror")):"function"==typeof define&&define.amd?define(["../../lib/codemirror"],e):e(CodeMirror)}(function(e){"use strict";function t(e,t){if(!e.hasOwnProperty(t))throw new Error("Undefined state "+t+" in simple mode")}function n(e,t){if(!e)return/(?:)/;var n="";return e instanceof RegExp?(e.ignoreCase&&(n="i"),e=e.source):e=String(e),new RegExp((!1===t?"":"^")+"(?:"+e+")",n)}function a(t,a){return function(o,i){if(i.pending){var l=i.pending.shift();return 0==i.pending.length&&(i.pending=null),o.pos+=l.text.length,l.token}if(i.local){if(i.local.end&&o.match(i.local.end)){d=i.local.endToken||null;return i.local=i.localState=null,d}var s,d=i.local.mode.token(o,i.localState);return i.local.endScan&&(s=i.local.endScan.exec(o.current()))&&(o.pos=o.start+s.index),d}for(var c=t[i.state],u=0;u<c.length;u++){var p=c[u],f=(!p.data.sol||o.sol())&&o.match(p.regex);if(f){p.data.next?i.state=p.data.next:p.data.push?((i.stack||(i.stack=[])).push(i.state),i.state=p.data.push):p.data.pop&&i.stack&&i.stack.length&&(i.state=i.stack.pop()),p.data.mode&&function(t,a,o,i){var l;if(o.persistent)for(var s=a.persistentStates;s&&!l;s=s.next)(o.spec?r(o.spec,s.spec):o.mode==s.mode)&&(l=s);var d=l?l.mode:o.mode||e.getMode(t,o.spec),c=l?l.state:e.startState(d);o.persistent&&!l&&(a.persistentStates={mode:d,spec:o.spec,state:c,next:a.persistentStates});a.localState=c,a.local={mode:d,end:o.end&&n(o.end),endScan:o.end&&!1!==o.forceEnd&&n(o.end,!1),endToken:i&&i.join?i[i.length-1]:i}}(a,i,p.data.mode,p.token),p.data.indent&&i.indent.push(o.indentation()+a.indentUnit),p.data.dedent&&i.indent.pop();var h=p.token;if(h&&h.apply&&(h=h(f)),f.length>2&&p.token&&"string"!=typeof p.token){i.pending=[];for(var g=2;g<f.length;g++)f[g]&&i.pending.push({text:f[g],token:p.token[g-1]});return o.backUp(f[0].length-(f[1]?f[1].length:0)),h[0]}return h&&h.join?h[0]:h}}return o.next(),null}}function r(e,t){if(e===t)return!0;if(!e||"object"!=typeof e||!t||"object"!=typeof t)return!1;var n=0;for(var a in e)if(e.hasOwnProperty(a)){if(!t.hasOwnProperty(a)||!r(e[a],t[a]))return!1;n++}for(var a in t)t.hasOwnProperty(a)&&n--;return 0==n}e.defineSimpleMode=function(t,n){e.defineMode(t,function(t){return e.simpleMode(t,n)})},e.simpleMode=function(r,o){t(o,"start");var i={},l=o.meta||{},s=!1;for(var d in o)if(d!=l&&o.hasOwnProperty(d))for(var c=i[d]=[],u=o[d],p=0;p<u.length;p++){var f=u[p];c.push(new function(e,a){(e.next||e.push)&&t(a,e.next||e.push),this.regex=n(e.regex),this.token=function(e){if(!e)return null;if(e.apply)return e;if("string"==typeof e)return e.replace(/\./g," ");for(var t=[],n=0;n<e.length;n++)t.push(e[n]&&e[n].replace(/\./g," "));return t}(e.token),this.data=e}(f,o)),(f.indent||f.dedent)&&(s=!0)}var h={startState:function(){return{state:"start",pending:null,local:null,localState:null,indent:s?[]:null}},copyState:function(t){var n={state:t.state,pending:t.pending,local:t.local,localState:null,indent:t.indent&&t.indent.slice(0)};t.localState&&(n.localState=e.copyState(t.local.mode,t.localState)),t.stack&&(n.stack=t.stack.slice(0));for(var a=t.persistentStates;a;a=a.next)n.persistentStates={mode:a.mode,spec:a.spec,state:a.state==t.localState?n.localState:e.copyState(a.mode,a.state),next:n.persistentStates};return n},token:a(i,r),innerMode:function(e){return e.local&&{mode:e.local.mode,state:e.localState}},indent:function(t,n){return function(a,r,o){if(a.local&&a.local.mode.indent)return a.local.mode.indent(a.localState,r,o);if(null==a.indent||a.local||n.dontIndentStates&&function(e,t){for(var n=0;n<t.length;n++)if(t[n]===e)return!0}(a.state,n.dontIndentStates)>-1)return e.Pass;var i=a.indent.length-1,l=t[a.state];e:for(;;){for(var s=0;s<l.length;s++){var d=l[s];if(d.data.dedent&&!1!==d.data.dedentIfLineStart){var c=d.regex.exec(r);if(c&&c[0]){i--,(d.next||d.push)&&(l=t[d.next||d.push]),r=r.slice(c[0].length);continue e}}}break}return i<0?0:a.indent[i]}}(i,l)};if(l)for(var g in l)l.hasOwnProperty(g)&&(h[g]=l[g]);return h}});