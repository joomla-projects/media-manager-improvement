!function(a){"object"==typeof exports&&"object"==typeof module?a(require("../../lib/codemirror")):"function"==typeof define&&define.amd?define(["../../lib/codemirror"],a):a(CodeMirror)}(function(a){function b(a,b){return"pairs"==b&&"string"==typeof a?a:"object"==typeof a&&null!=a[b]?a[b]:l[b]}function c(a){var b=a.state.closeBrackets;return!b||b.override?b:a.getModeAt(a.getCursor()).closeBrackets||b}function d(d){var e=c(d);if(!e||d.getOption("disableInput"))return a.Pass;for(var f=b(e,"pairs"),g=d.listSelections(),h=0;h<g.length;h++){if(!g[h].empty())return a.Pass;var j=i(d,g[h].head);if(!j||f.indexOf(j)%2!=0)return a.Pass}for(var h=g.length-1;h>=0;h--){var k=g[h].head;d.replaceRange("",m(k.line,k.ch-1),m(k.line,k.ch+1),"+delete")}}function e(d){var e=c(d),f=e&&b(e,"explode");if(!f||d.getOption("disableInput"))return a.Pass;for(var g=d.listSelections(),h=0;h<g.length;h++){if(!g[h].empty())return a.Pass;var j=i(d,g[h].head);if(!j||f.indexOf(j)%2!=0)return a.Pass}d.operation(function(){d.replaceSelection("\n\n",null),d.execCommand("goCharLeft"),g=d.listSelections();for(var a=0;a<g.length;a++){var b=g[a].head.line;d.indentLine(b,null,!0),d.indentLine(b+1,null,!0)}})}function f(b){var c=a.cmpPos(b.anchor,b.head)>0;return{anchor:new m(b.anchor.line,b.anchor.ch+(c?-1:1)),head:new m(b.head.line,b.head.ch+(c?1:-1))}}function g(d,e){var g=c(d);if(!g||d.getOption("disableInput"))return a.Pass;var i=b(g,"pairs"),l=i.indexOf(e);if(l==-1)return a.Pass;for(var n,o=b(g,"triples"),p=i.charAt(l+1)==e,q=d.listSelections(),r=l%2==0,s=0;s<q.length;s++){var t,u=q[s],v=u.head,w=d.getRange(v,m(v.line,v.ch+1));if(r&&!u.empty())t="surround";else if(!p&&r||w!=e)if(p&&v.ch>1&&o.indexOf(e)>=0&&d.getRange(m(v.line,v.ch-2),v)==e+e&&(v.ch<=2||d.getRange(m(v.line,v.ch-3),m(v.line,v.ch-2))!=e))t="addFour";else if(p){if(a.isWordChar(w)||!j(d,v,e))return a.Pass;t="both"}else{if(!r||d.getLine(v.line).length!=v.ch&&!h(w,i)&&!/\s/.test(w))return a.Pass;t="both"}else t=p&&k(d,v)?"both":o.indexOf(e)>=0&&d.getRange(v,m(v.line,v.ch+3))==e+e+e?"skipThree":"skip";if(n){if(n!=t)return a.Pass}else n=t}var x=l%2?i.charAt(l-1):e,y=l%2?e:i.charAt(l+1);d.operation(function(){if("skip"==n)d.execCommand("goCharRight");else if("skipThree"==n)for(var a=0;a<3;a++)d.execCommand("goCharRight");else if("surround"==n){for(var b=d.getSelections(),a=0;a<b.length;a++)b[a]=x+b[a]+y;d.replaceSelections(b,"around"),b=d.listSelections().slice();for(var a=0;a<b.length;a++)b[a]=f(b[a]);d.setSelections(b)}else"both"==n?(d.replaceSelection(x+y,null),d.triggerElectric(x+y),d.execCommand("goCharLeft")):"addFour"==n&&(d.replaceSelection(x+x+x+x,"before"),d.execCommand("goCharRight"))})}function h(a,b){var c=b.lastIndexOf(a);return c>-1&&c%2==1}function i(a,b){var c=a.getRange(m(b.line,b.ch-1),m(b.line,b.ch+1));return 2==c.length?c:null}function j(b,c,d){var e=b.getLine(c.line),f=b.getTokenAt(c);if(/\bstring2?\b/.test(f.type)||k(b,c))return!1;var g=new a.StringStream(e.slice(0,c.ch)+d+e.slice(c.ch),4);for(g.pos=g.start=f.start;;){var h=b.getMode().token(g,f.state);if(g.pos>=c.ch+1)return/\bstring2?\b/.test(h);g.start=g.pos}}function k(a,b){var c=a.getTokenAt(m(b.line,b.ch+1));return/\bstring/.test(c.type)&&c.start==b.ch}var l={pairs:"()[]{}''\"\"",triples:"",explode:"[]{}"},m=a.Pos;a.defineOption("autoCloseBrackets",!1,function(b,c,d){d&&d!=a.Init&&(b.removeKeyMap(o),b.state.closeBrackets=null),c&&(b.state.closeBrackets=c,b.addKeyMap(o))});for(var n=l.pairs+"`",o={Backspace:d,Enter:e},p=0;p<n.length;p++)o["'"+n.charAt(p)+"'"]=function(a){return function(b){return g(b,a)}}(n.charAt(p))});