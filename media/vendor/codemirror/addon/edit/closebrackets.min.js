!function(e){"object"==typeof exports&&"object"==typeof module?e(require("../../lib/codemirror")):"function"==typeof define&&define.amd?define(["../../lib/codemirror"],e):e(CodeMirror)}(function(e){function t(e,t){return"pairs"==t&&"string"==typeof e?e:"object"==typeof e&&null!=e[t]?e[t]:s[t]}function n(n){for(var a=0;a<n.length;a++){var s=n.charAt(a),f="'"+s+"'";c[f]||(c[f]=function(n){return function(a){return function(n,a){var s=r(n);if(!s||n.getOption("disableInput"))return e.Pass;var c=t(s,"pairs"),f=c.indexOf(a);if(-1==f)return e.Pass;for(var u,h=t(s,"triples"),d=c.charAt(f+1)==a,g=n.listSelections(),p=f%2==0,v=0;v<g.length;v++){var m,b=g[v],x=b.head,C=n.getRange(x,l(x.line,x.ch+1));if(p&&!b.empty())m="surround";else if(!d&&p||C!=a)if(d&&x.ch>1&&h.indexOf(a)>=0&&n.getRange(l(x.line,x.ch-2),x)==a+a&&(x.ch<=2||n.getRange(l(x.line,x.ch-3),l(x.line,x.ch-2))!=a))m="addFour";else if(d){if(e.isWordChar(C)||!function(t,n,r){var i=t.getLine(n.line),a=t.getTokenAt(n);if(/\bstring2?\b/.test(a.type)||o(t,n))return!1;var s=new e.StringStream(i.slice(0,n.ch)+r+i.slice(n.ch),4);for(s.pos=s.start=a.start;;){var l=t.getMode().token(s,a.state);if(s.pos>=n.ch+1)return/\bstring2?\b/.test(l);s.start=s.pos}}(n,x,a))return e.Pass;m="both"}else{if(!p||n.getLine(x.line).length!=x.ch&&!function(e,t){var n=t.lastIndexOf(e);return n>-1&&n%2==1}(C,c)&&!/\s/.test(C))return e.Pass;m="both"}else m=d&&o(n,x)?"both":h.indexOf(a)>=0&&n.getRange(x,l(x.line,x.ch+3))==a+a+a?"skipThree":"skip";if(u){if(u!=m)return e.Pass}else u=m}var S=f%2?c.charAt(f-1):a,k=f%2?a:c.charAt(f+1);n.operation(function(){if("skip"==u)n.execCommand("goCharRight");else if("skipThree"==u)for(t=0;t<3;t++)n.execCommand("goCharRight");else if("surround"==u){for(var e=n.getSelections(),t=0;t<e.length;t++)e[t]=S+e[t]+k;n.replaceSelections(e,"around"),e=n.listSelections().slice();for(t=0;t<e.length;t++)e[t]=i(e[t]);n.setSelections(e)}else"both"==u?(n.replaceSelection(S+k,null),n.triggerElectric(S+k),n.execCommand("goCharLeft")):"addFour"==u&&(n.replaceSelection(S+S+S+S,"before"),n.execCommand("goCharRight"))})}(a,n)}}(s))}}function r(e){var t=e.state.closeBrackets;if(!t||t.override)return t;return e.getModeAt(e.getCursor()).closeBrackets||t}function i(t){var n=e.cmpPos(t.anchor,t.head)>0;return{anchor:new l(t.anchor.line,t.anchor.ch+(n?-1:1)),head:new l(t.head.line,t.head.ch+(n?1:-1))}}function a(e,t){var n=e.getRange(l(t.line,t.ch-1),l(t.line,t.ch+1));return 2==n.length?n:null}function o(e,t){var n=e.getTokenAt(l(t.line,t.ch+1));return/\bstring/.test(n.type)&&n.start==t.ch}var s={pairs:"()[]{}''\"\"",triples:"",explode:"[]{}"},l=e.Pos;e.defineOption("autoCloseBrackets",!1,function(r,i,a){a&&a!=e.Init&&(r.removeKeyMap(c),r.state.closeBrackets=null),i&&(n(t(i,"pairs")),r.state.closeBrackets=i,r.addKeyMap(c))});var c={Backspace:function(n){var i=r(n);if(!i||n.getOption("disableInput"))return e.Pass;for(var o=t(i,"pairs"),s=n.listSelections(),c=0;c<s.length;c++){if(!s[c].empty())return e.Pass;var f=a(n,s[c].head);if(!f||o.indexOf(f)%2!=0)return e.Pass}for(c=s.length-1;c>=0;c--){var u=s[c].head;n.replaceRange("",l(u.line,u.ch-1),l(u.line,u.ch+1),"+delete")}},Enter:function(n){var i=r(n),o=i&&t(i,"explode");if(!o||n.getOption("disableInput"))return e.Pass;for(var s=n.listSelections(),l=0;l<s.length;l++){if(!s[l].empty())return e.Pass;var c=a(n,s[l].head);if(!c||o.indexOf(c)%2!=0)return e.Pass}n.operation(function(){var e=n.lineSeparator()||"\n";n.replaceSelection(e+e,null),n.execCommand("goCharLeft"),s=n.listSelections();for(var t=0;t<s.length;t++){var r=s[t].head.line;n.indentLine(r,null,!0),n.indentLine(r+1,null,!0)}})}};n(s.pairs+"`")});