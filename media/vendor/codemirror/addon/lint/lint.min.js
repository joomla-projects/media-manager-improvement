!function(t){"object"==typeof exports&&"object"==typeof module?t(require("../../lib/codemirror")):"function"==typeof define&&define.amd?define(["../../lib/codemirror"],t):t(CodeMirror)}(function(t){"use strict";function e(t){t.parentNode&&t.parentNode.removeChild(t)}function n(n,o,r){function i(){t.off(r,"mouseout",i),a&&(!function(t){t.parentNode&&(null==t.style.opacity&&e(t),t.style.opacity=0,setTimeout(function(){e(t)},600))}(a),a=null)}var a=function(e,n){function o(e){if(!r.parentNode)return t.off(document,"mousemove",o);r.style.top=Math.max(0,e.clientY-r.offsetHeight-5)+"px",r.style.left=e.clientX+5+"px"}var r=document.createElement("div");return r.className="CodeMirror-lint-tooltip",r.appendChild(n.cloneNode(!0)),document.body.appendChild(r),t.on(document,"mousemove",o),o(e),null!=r.style.opacity&&(r.style.opacity=1),r}(n,o),s=setInterval(function(){if(a)for(var t=r;;t=t.parentNode){if(t&&11==t.nodeType&&(t=t.host),t==document.body)return;if(!t){i();break}}if(!a)return clearInterval(s)},400);t.on(r,"mouseout",i)}function o(t,e,o){this.marked=[],this.options=e,this.timeout=null,this.hasGutter=o,this.onMouseOver=function(e){!function(t,e){var o=e.target||e.srcElement;if(!/\bCodeMirror-lint-mark-/.test(o.className))return;for(var r=o.getBoundingClientRect(),i=(r.left+r.right)/2,a=(r.top+r.bottom)/2,u=t.findMarksAt(t.coordsChar({left:i,top:a},"client")),l=[],c=0;c<u.length;++c){var f=u[c].__annotation;f&&l.push(f)}l.length&&function(t,e){for(var o=e.target||e.srcElement,r=document.createDocumentFragment(),i=0;i<t.length;i++){var a=t[i];r.appendChild(s(a))}n(e,r,o)}(l,e)}(t,e)},this.waitingFor=0}function r(t){var e=t.state.lint;e.hasGutter&&t.clearGutter(f);for(var n=0;n<e.marked.length;++n)e.marked[n].clear();e.marked.length=0}function i(e,o,r,i){var a=document.createElement("div"),s=a;return a.className="CodeMirror-lint-marker-"+o,r&&((s=a.appendChild(document.createElement("div"))).className="CodeMirror-lint-marker-multiple"),0!=i&&t.on(s,"mouseover",function(t){n(t,e,s)}),a}function a(t,e){return"error"==t?t:e}function s(t){var e=t.severity;e||(e="error");var n=document.createElement("div");return n.className="CodeMirror-lint-message-"+e,void 0!==t.messageHTML?n.innerHTML=t.messageHTML:n.appendChild(document.createTextNode(t.message)),n}function u(e){var n=e.state.lint.options,o=n.options||n,r=n.getAnnotations||e.getHelper(t.Pos(0,0),"lint");if(r)if(n.async||r.async)!function(e,n,o){function r(){a=-1,e.off("change",r)}var i=e.state.lint,a=++i.waitingFor;e.on("change",r),n(e.getValue(),function(n,o){e.off("change",r),i.waitingFor==a&&(o&&n instanceof t&&(n=o),l(e,n))},o,e)}(e,r,o);else{var i=r(e.getValue(),o,e);if(!i)return;i.then?i.then(function(t){l(e,t)}):l(e,i)}}function l(t,e){r(t);for(var n=t.state.lint,o=n.options,u=function(t){for(var e=[],n=0;n<t.length;++n){var o=t[n],r=o.from.line;(e[r]||(e[r]=[])).push(o)}return e}(e),l=0;l<u.length;++l){var c=u[l];if(c){for(var m=null,d=n.hasGutter&&document.createDocumentFragment(),p=0;p<c.length;++p){var h=c[p],g=h.severity;g||(g="error"),m=a(m,g),o.formatAnnotation&&(h=o.formatAnnotation(h)),n.hasGutter&&d.appendChild(s(h)),h.to&&n.marked.push(t.markText(h.from,h.to,{className:"CodeMirror-lint-mark-"+g,__annotation:h}))}n.hasGutter&&t.setGutterMarker(l,f,i(d,m,c.length>1,n.options.tooltips))}}o.onUpdateLinting&&o.onUpdateLinting(e,u,t)}function c(t){var e=t.state.lint;e&&(clearTimeout(e.timeout),e.timeout=setTimeout(function(){u(t)},e.options.delay||500))}var f="CodeMirror-lint-markers";t.defineOption("lint",!1,function(e,n,i){if(i&&i!=t.Init&&(r(e),!1!==e.state.lint.options.lintOnChange&&e.off("change",c),t.off(e.getWrapperElement(),"mouseover",e.state.lint.onMouseOver),clearTimeout(e.state.lint.timeout),delete e.state.lint),n){for(var a=e.getOption("gutters"),s=!1,l=0;l<a.length;++l)a[l]==f&&(s=!0);var m=e.state.lint=new o(e,function(t,e){return e instanceof Function?{getAnnotations:e}:(e&&!0!==e||(e={}),e)}(0,n),s);!1!==m.options.lintOnChange&&e.on("change",c),0!=m.options.tooltips&&"gutter"!=m.options.tooltips&&t.on(e.getWrapperElement(),"mouseover",m.onMouseOver),u(e)}}),t.defineExtension("performLint",function(){this.state.lint&&u(this)})});