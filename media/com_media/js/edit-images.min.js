Joomla=window.Joomla||{},Joomla.MediaManager=Joomla.MediaManager||{},function(){"use strict";var e=Joomla.getOptions("com_media",{});if(e){Joomla.MediaManager.Edit.original={filename:e.uploadPath.split("/").pop(),extension:e.uploadPath.split(".").pop(),contents:"data:image/"+e.uploadPath.split(".").pop()+";base64,"+e.contents},Joomla.MediaManager.Edit.history={},Joomla.MediaManager.Edit.current={},Joomla.MediaManager.Edit.Reset=function(e){(!e||e&&!0!==e)&&(Joomla.MediaManager.Edit.current.contents=Joomla.MediaManager.Edit.original.contents),document.getElementById("media-manager-edit-container").innerHTML="";for(var t=[].slice.call(document.querySelectorAll('[data-toggle="tab"]')),o=0,n=t.length;o<n;o++)if(t[o].classList.contains("active")){Joomla.MediaManager.Edit[t[o].hash.replace("#attrib-","").toLowerCase()].Deactivate();var i=Joomla.MediaManager.Edit.current;(!e||e&&!0!==e)&&(i=Joomla.MediaManager.Edit.original),a(t[o].hash.replace("#attrib-",""),i);break}},window.addEventListener("mediaManager.history.point",function(){if(Joomla.MediaManager.Edit.original!==Joomla.MediaManager.Edit.current.contents){var e=Object.keys(Joomla.MediaManager.Edit.history).length;if(Joomla.MediaManager.Edit.history[e]&&Joomla.MediaManager.Edit.history[e-1]&&Joomla.MediaManager.Edit.history[e]===Joomla.MediaManager.Edit.history[e-1])return;Joomla.MediaManager.Edit.history[e+1]=JSON.parse.contents}}),Joomla.MediaManager.Edit.Undo=function(){},Joomla.MediaManager.Edit.Redo=function(){},Joomla.MediaManager.Edit.createProgressBar=function(){!function(e,a){var t="mediaProgress",o="";("string"==typeof e||e instanceof String)&&(t+=e,o="<p>"+e+"</p>");var n=document.createElement("joomla-alert");n.setAttribute("type",a.type||"info"),n.setAttribute("dismiss",a.dismiss||!0),n.setAttribute("auto-dismiss",a.autoDismiss||!1),n.innerHTML='<progress id="'+t+'" class="media-manager-progress" value="0" max="100"></progress><span>0 %</span>'+o,document.getElementById("system-message").appendChild(n)}(e.uploadPath.split("/").pop(),{type:"success"})},Joomla.MediaManager.Edit.updateProgressBar=function(a){var t=e.uploadPath.split("/").pop(),o=0;a.lengthComputable&&(o=Math.round(a.loaded/a.total*100)),function(e,a){var t="mediaProgress";("string"==typeof e||e instanceof String)&&(t+=e);var o=document.getElementById(t),n=document.getElementById(t).nextSibling;o.setAttribute("value",a),n.innerHTML=a+" %"}(t,o)},Joomla.MediaManager.Edit.Promise=function(){var a="jpg"===Joomla.MediaManager.Edit.original.extension?"jpeg":Joomla.MediaManager.Edit.original.extension,t=(window.location.pathname.replace(/&view=file.*/g,""),e.uploadPath.split("/").pop()),o=e.uploadPath,n=e.apiBaseUrl+"&task=api.files&path="+o,i={name:t,content:Joomla.MediaManager.Edit.current.contents.replace("data:image/"+a+";base64,","")};i[e.csrfToken]="1";var r=o.split("/");return r.pop(),(r=r.join("/")).endsWith(":")&&(r+="/"),new Promise((e,a)=>{Joomla.UploadFile.exec({name:t,data:JSON.stringify(i),url:n,headers:{"Content-Type":"application/json"},method:"PUT",onBefore:Joomla.MediaManager.Edit.createProgressBar(),onSuccess:a=>{e(a)},onError:e=>{a(e)},onUploadProgress:Joomla.MediaManager.Edit.updateProgressBar})})},Joomla.submitbutton=function(a){var o=window.location.pathname.replace(/&view=file.*/g,""),n=e.uploadPath.split("/");switch(n.pop(),(n=n.join("/")).endsWith(":")&&(n+="/"),a){case"apply":Joomla.MediaManager.Edit.Promise().then(function(e,a){try{var o=JSON.parse(e)}catch(e){o=null}if(o&&1==o.success)Joomla.MediaManager.Edit.Reset(!0);else{window.log&&console.log("error",Joomla.JText._("COM_MEDIA_SERVER_ERROR","COM_MEDIA_SERVER_ERROR"));t("COM_MEDIA_SERVER_ERROR",{type:"danger"}),Joomla.MediaManager.Edit.Reset(!0)}}).catch(e=>{!window.log||console.log("error",Joomla.JText._("COM_MEDIA_ERROR","COM_MEDIA_ERROR"));t("COM_MEDIA_ERROR",{type:"danger",dismiss:"false",autoDismiss:"false"}),Joomla.MediaManager.Edit.Reset(!0)});break;case"save":Joomla.MediaManager.Edit.Promise().then(function(e,a){try{var i=JSON.parse(e)}catch(e){i=null}if(i&&1==i.success)window.location=o+"?option=com_media&path="+n;else{window.log&&console.log("error",Joomla.JText._("COM_MEDIA_SERVER_ERROR","COM_MEDIA_SERVER_ERROR"));t("COM_MEDIA_SERVER_ERROR",{type:"danger",dismiss:"false",autoDismiss:"false"}),Joomla.MediaManager.Edit.Reset(!0)}}).catch(e=>{!window.log||console.log("error",Joomla.JText._("COM_MEDIA_ERROR","COM_MEDIA_ERROR"));t("COM_MEDIA_ERROR",{type:"danger",dismiss:"false",autoDismiss:"false"}),Joomla.MediaManager.Edit.Reset(!0)});break;case"cancel":window.location=o+"?option=com_media&path="+n;break;case"reset":Joomla.MediaManager.Edit.Reset("initial")}},Joomla.UploadFile={},Joomla.UploadFile.exec=function(e){e=Joomla.extend({url:"",method:"GET",data:null,perform:!0},e);try{var a=new XMLHttpRequest;if(a.onload=function(){e.onSuccess&&e.onSuccess.call(this,a.responseText,a)},a.onerror=function(){e.onError&&e.onError.call(this,a)},e.onUploadProgress&&a.upload.addEventListener("progress",e.onUploadProgress),e.onUploadComplete&&a.upload.addEventListener("load",e.onUploadComplete),e.onUploadError&&a.upload.addEventListener("error",e.onUploadError),e.onUploadAbort&&a.upload.addEventListener("abort",e.onUploadAbort),a.onprogress=function(){e.onProgress&&e.onProgress(event)},a.open(e.method,e.url,!0),a.setRequestHeader("X-Requested-With","XMLHttpRequest"),a.setRequestHeader("X-Ajax-Engine","Joomla!"),"GET"!==e.method){var t=Joomla.getOptions("csrf.token","");t&&a.setRequestHeader("X-CSRF-Token",t),e.headers&&e.headers["Content-Type"]||a.setRequestHeader("Content-Type","application/x-www-form-urlencoded")}if(e.headers)for(var o in e.headers)e.headers.hasOwnProperty(o)&&a.setRequestHeader(o,e.headers[o]);if(e.perform){if(e.onBefore&&!1===e.onBefore.call(this,a))return a;a.send(e.data)}}catch(e){return window.console&&console.log(e),!1}},document.addEventListener("DOMContentLoaded",function(){setTimeout(function(){var e=[].slice.call(document.querySelectorAll('[data-toggle="tab"]'));if(e.length){for(var t=0,o=e.length;t<o;t++)jQuery(e[t]).on("shown.bs.tab",function(e){e.relatedTarget&&(Joomla.MediaManager.Edit[e.relatedTarget.hash.replace("#attrib-","").toLowerCase()].Deactivate(),document.getElementById("media-manager-edit-container").innerHTML="");var t=Joomla.MediaManager.Edit.current;!0 in Joomla.MediaManager.Edit.current&&(t=Joomla.MediaManager.Edit.original),a(e.target.hash.replace("#attrib-",""),t)});a(e[0].hash.replace("#attrib-",""),Joomla.MediaManager.Edit.original)}},100)});var a=function(e,a){var t=document.getElementById("myTabContent"),o=document.getElementById("attrib-"+e);t.classList.add("row","ml-0","mr-0","p-0"),o.classList.add("col-md-3","p-4");var n=document.getElementById("media-manager-edit-container"),i=document.createElement("div"),r=document.createElement("div"),s=document.createElement("img"),d=document.createElement("img");n.innerHTML="",s.src=a.contents,s.id="image-source",s.style.maxWidth="100%",d.src=a.contents,d.id="image-preview",d.style.maxWidth="100%",i.style.display="none",i.appendChild(s),n.appendChild(i),r.appendChild(d),n.appendChild(r),Joomla.MediaManager.Edit[e.toLowerCase()].Activate(a)}}function t(e,a){var t=document.createElement("joomla-alert");t.setAttribute("type",a.type||"info"),t.setAttribute("dismiss",a.dismiss||!0),t.setAttribute("auto-dismiss",a.autoDismiss||!0),t.innerHTML=Joomla.JText._(e,e)||"",document.getElementById("system-message").appendChild(t)}}();